<!doctype html><html lang="en"
  >
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>GORM学习 - Euraxluo Blog</title><link rel="apple-touch-icon" href="/images/icons/icon-180x180.png" sizes="180x180">
<link rel="icon" href="/images/icons/icon-32x32.png" sizes="32x32" type="image/png">
<link rel="icon" href="/images/icons/icon-16x16.png" sizes="16x16" type="image/png">
<link rel="icon" href="/images/icons/favicon.ico">
<link rel="manifest" href="/manifest.json">
<meta name="keywords" content="" />
<meta name="description" content="GORM学习" /><meta itemprop="name" content="GORM学习">
<meta itemprop="description" content="GORM学习">
<meta itemprop="datePublished" content="2022-02-10T00:00:00+00:00" />
<meta itemprop="dateModified" content="2022-02-10T00:00:00+00:00" />
<meta itemprop="wordCount" content="3438">



<meta itemprop="keywords" content="gorm," />
<meta property="og:title" content="GORM学习" />
<meta property="og:description" content="GORM学习" />
<meta property="og:type" content="article" />
<meta property="og:url" content="/posts/note/gorm/" />
<meta property="article:published_time" content="2022-02-10T00:00:00+00:00" />
<meta property="article:modified_time" content="2022-02-10T00:00:00+00:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="GORM学习"/>
<meta name="twitter:description" content="GORM学习"/>
<link rel="stylesheet" href="/css/main.min.28a3ca343dd0a7bd1957907fcd87aef64aaaa4ae30eb486ada4e888fd95ae91b.css" integrity="sha256-KKPKND3Qp70ZV5B/zYeu9kqqpK4w60hq2k6Ij9la6Rs=" crossorigin="anonymous"><link rel="stylesheet" href="/css/katex.min.52bcb5669e86f59157424ba25853a6b20465391634a4ab5d7d42563c713ea165.css" integrity="sha256-Ury1Zp6G9ZFXQkuiWFOmsgRlORY0pKtdfUJWPHE&#43;oWU=" crossorigin="anonymous">
<link rel="stylesheet" href="/css/viewer.min.f66ccd366c47e7fdadd4ff99e528f941dfebc6dfa1b7abec38803f94064139c1.css" integrity="sha256-9mzNNmxH5/2t1P&#43;Z5Sj5Qd/rxt&#43;ht6vsOIA/lAZBOcE=" crossorigin="anonymous"></head>
  <body><script>const items=['mode','palette'];items.forEach(function(key){const value=localStorage.getItem('hbs-'+key);if(value){document.body.parentElement.setAttribute('data-'+key,value);}});</script><header><nav class="navbar top-app-bar top-app-bar-expand-lg fixed-top">
  <div class="container-fluid">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <i class="fas fa-bars"></i>
    </button><a class="navbar-brand me-3" href="/"><img class="logo" alt="Logo" src="https://gitee.com/Euraxluo/images/raw/master/picgo/profile.png" loading="lazy"
  
   />
Euraxluo
    </a>
    <button class="navbar-social-share" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSocialShare"
  aria-controls="offcanvasSocialShare" aria-label="Toggle social share">
  <i class="fas fa-share-alt"></i>
</button>

<div class="offcanvas offcanvas-bottom surface" tabindex="-1" id="offcanvasSocialShare" aria-labelledby="offcanvasSocialShare">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Share</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body">
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Twitter Share Button"
      target="_blank" href="https://twitter.com/intent/tweet?title=GORM%e5%ad%a6%e4%b9%a0&url=%2fposts%2fnote%2fgorm%2f">
      <i class="fab fa-fw fa-twitter"></i> Twitter
    </a>
    <a class="btn btn-sm btn-outline-primary social-share-button" rel="noopener noreferrer" aria-label="Facebook Share Button"
      target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=%2fposts%2fnote%2fgorm%2f">
      <i class="fab fa-fw fa-facebook-f"></i> Facebook
    </a>
  </div>
</div>
    <button class="navbar-settings" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasSettings"
  aria-controls="offcanvasSettings" aria-label="Toggle settings">
  <i class="fas fa-ellipsis-v"></i>
</button>

<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasSettings" aria-labelledby="offcanvasSettings">
  <div class="offcanvas-header">
    <h3 class="offcanvas-title">Settings</h3>
    <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
      <i class="fas fa-times"></i>
    </button>
  </div>
  <div class="offcanvas-body d-flex flex-column">

<section class="setting">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-adjust"></i> Mode</label>
    </div>
    <div class="col-auto ms-auto">
      <div class="form-check form-switch">
        <input class="form-check-input" type="checkbox" id="modeSwitcher">
      </div>
    </div>
  </form>
</section>

<section class="setting">
  <form class="font-size-switcher-form row">
    <div class="col-auto">
      <label for="fontSize" class="form-label"><i class="fas fa-fw fa-font"></i> Font Size</label>
    </div>
    <div class="col-auto ms-auto">
      <input type="range" class="form-range" min="-2" max="2" id="fontSize">
    </div>
  </form>
</section>


<section class="setting palettes">
  <form class="row">
    <div class="col-auto">
      <label><i class="fas fa-fw fa-palette"></i> Palette</label>
    </div>
    <div class="col-auto ms-auto">
      <a id="btnPalette" class="btn btn-sm btn-outline-primary" role="button" aria-label="palettePicker">
        <i class="fas fa-eye-dropper"></i>
      </a>
    </div>
  </form>
  <div class="mt-2 d-flex visually-hidden" id="palettePicker"><button type="button" id="palette-blue" aria-label="Blue"
        class="btn btn-sm palette" data-palette="blue">
      </button><button type="button" id="palette-blue-gray" aria-label="Blue Gray"
        class="btn btn-sm palette" data-palette="blue-gray">
      </button><button type="button" id="palette-brown" aria-label="Brown"
        class="btn btn-sm palette" data-palette="brown">
      </button><button type="button" id="palette-cyan" aria-label="Cyan"
        class="btn btn-sm palette" data-palette="cyan">
      </button><button type="button" id="palette-green" aria-label="Green"
        class="btn btn-sm palette" data-palette="green">
      </button><button type="button" id="palette-indigo" aria-label="Indigo"
        class="btn btn-sm palette" data-palette="indigo">
      </button><button type="button" id="palette-orange" aria-label="Orange"
        class="btn btn-sm palette" data-palette="orange">
      </button><button type="button" id="palette-pink" aria-label="Pink"
        class="btn btn-sm palette" data-palette="pink">
      </button><button type="button" id="palette-purple" aria-label="Purple"
        class="btn btn-sm palette" data-palette="purple">
      </button><button type="button" id="palette-red" aria-label="Red"
        class="btn btn-sm palette" data-palette="red">
      </button><button type="button" id="palette-teal" aria-label="Teal"
        class="btn btn-sm palette" data-palette="teal">
      </button><button type="button" id="palette-yellow" aria-label="Yellow"
        class="btn btn-sm palette" data-palette="yellow">
      </button></div>
</section>
<section class="setting actions d-flex justify-content-center mt-auto">
  <a role="button" class="action action-reload-page">
    <span class="action-icon"><i class="fas fa-2x fa-redo-alt"></i></span> Reload
  </a>
  <a role="button" class="action action-copy-url">
    <span class="action-icon"><i class="fas fa-2x fa-link"></i></span> Copy URL
  </a>
</section>

</div>
</div>

    <div class="collapse navbar-collapse" tabindex="-1" id="navbarSupportedContent" aria-labelledby="navbarSupportedContent">
      <form class="search-bar my-1" action="/search">
  <div class="input-group input-group-sm">
    <span class="btn btn-search disabled position-absolute left-0"><i class="fas fa-fw fa-search"></i></span>
    <input class="form-control rounded-pill" name="q" type="search" aria-label="Search">
  </div>
</form>
      <ul class="navbar-nav ms-auto"><li class="nav-item">
          <a class="nav-link" href="/archives">
            <i class="fas fa-fw fa-file-archive"></i>timeline
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/categories">
            <i class="fas fa-fw fa-folder"></i>category
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/tags">
            <i class="fas fa-fw fa-tags"></i>tags
          </a>
        </li><li class="nav-item">
          <a class="nav-link" href="/series">
            <i class="fas fa-fw fa-columns"></i>series
          </a>
        </li><li class="nav-item dropdown">
          <a class="nav-link" id="navbarDropdownRepos" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fab fa-fw fa-github"></i>Repos
          </a>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdownRepos"><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>Euraxluo
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo/fastgrpc" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>fastgrpc
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo/ProjectPractice" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>ProjectPractice
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo/pyantv" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>pyantv
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo/simple_pyvm" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>simple-pythonvm
              </a>
            </li><li>
              <a class="dropdown-item"
                href="https://github.com/Euraxluo/verb" target="_blank" rel="noopener noreferrer">
                <i class="fab fa-fw fa-github"></i>verb
              </a>
            </li></ul>
        </li></ul>
    </div>
  </div>
</nav>
</header>
<main role="main" class="container-fluid">
      <div class="row content">
<div class="col-lg-8">
  <div class="container"><article class="row card component mb-4 post"><div class="post-panel-wrapper">
  <div class="d-flex flex-column component rounded post-panel">
    
    <a id="sidebarToggler" class="action d-none d-lg-block" role="button" title="Sidebar toggler">
  <i class="fas fa-fw fa-expand-alt" data-fa-transform="rotate-45"></i>
</a>
  
    

    <a class="action btn-reward" role="button" data-bs-toggle="modal" data-bs-target="#rewardModal" title="Buy me a coffee">
  <i class="fas fa-fw fa-coffee"></i>
</a>
    <a class="action" href="#post-copyright" role="button" aria-label="Copyright" title="Copyright">
  <i class="fas fa-fw fa-copyright"></i>
</a>
    <a class="action" href="#post-comments" role="button" aria-label="Comments" title="Comments">
  <i class="fas fa-fw fa-comments"></i>
</a>
    <a class="action" data-bs-toggle="offcanvas" href="#offcanvasTOC" aria-controls="offcanvasTOC" role="button" title="Table of contents">
  <i class="fas fa-fw fa-list-alt"></i>
</a>
    
  </div>
</div>
<div class="card-header ">
    <h1 class="card-title post-title">GORM学习
</h1>
  </div>
  <div class="card-body"><div class="post-meta">
  <span class="post-date" title="created on 2022-02-10 08:00:00 &#43;0800 CST.">
    2022-02-10
  </span><span class="post-reading-time">
    17 min read
  </span><span class="post-taxonomies"><a href="/categories/notes/" class="badge rounded-pill post-taxonomy">notes</a><a href="/tags/gorm/" class="badge rounded-pill post-taxonomy">gorm</a></span>
</div>
<div class="offcanvas offcanvas-end surface h-100" tabindex="-1" id="offcanvasTOC" aria-labelledby="offcanvasTOCLabel">
  <div class="offcanvas-header">
    <h2 class="offcanvas-title" id="offcanvasTOCLabel">Table Of Contents</h5>
      <button type="button" class="btn btn-sm btn-outline-primary" data-bs-dismiss="offcanvas" aria-label="Close">
        <i class="fas fa-times"></i>
      </button>
  </div>
  <div class="offcanvas-body">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#gorm">GORM</a></li>
        <li><a href="#locking">Locking</a></li>
        <li><a href="#关联">关联</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div><div class="post-content mb-3"><h3 id="gorm">GORM<a class="anchor ms-1" href="#gorm"><i class="fas fa-link"></i></a></h3>
<h4 id="模型定义">模型定义<a class="anchor ms-1" href="#模型定义"><i class="fas fa-link"></i></a></h4>
<ol>
<li>
<p>模型实现了Scanner和Valuer接口</p>
</li>
<li>
<p>模型约定：</p>
<ul>
<li>
<p>GORM 使用<code>ID</code>作为主键</p>
<ul>
<li>
<p>如果不默认使用<code>ID</code>作为主键，应该使用标签<code>primaryKey</code> 指定</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#75715e">// 将 `UUID` 设为主键
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Animal</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>     <span style="color:#66d9ef">int64</span>
    <span style="color:#a6e22e">UUID</span>   <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`gorm:&#34;primaryKey&#34;`</span>
    <span style="color:#a6e22e">Name</span>   <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">Age</span>    <span style="color:#66d9ef">int64</span>
  }
</code></pre></div></li>
</ul>
</li>
<li>
<p>复合主键</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Product</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>           <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`gorm:&#34;primaryKey&#34;`</span>
    <span style="color:#a6e22e">LanguageCode</span> <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`gorm:&#34;primaryKey&#34;`</span>
    <span style="color:#a6e22e">Code</span>         <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">Name</span>         <span style="color:#66d9ef">string</span>
  }
</code></pre></div></li>
</ul>
</li>
<li>
<p>关闭整形主键的自增，显示关闭 <code>autoIncrement</code></p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Product</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">CategoryID</span> <span style="color:#66d9ef">uint64</span> <span style="color:#e6db74">`gorm:&#34;primaryKey;autoIncrement:false&#34;`</span>
    <span style="color:#a6e22e">TypeID</span>     <span style="color:#66d9ef">uint64</span> <span style="color:#e6db74">`gorm:&#34;primaryKey;autoIncrement:false&#34;`</span>
  }
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用结构体名的<strong>下划线表示的复数</strong>作为表名</p>
<ul>
<li>
<p>更改默认表名,为结构体实现<code>TableName</code>方法</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Tabler</span> <span style="color:#66d9ef">interface</span> {
      <span style="color:#a6e22e">TableName</span>() <span style="color:#66d9ef">string</span>
  }
                
  <span style="color:#75715e">// TableName 会将 User 的表名重写为 `profiles`
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">TableName</span>() <span style="color:#66d9ef">string</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;profiles&#34;</span>
  }
</code></pre></div></li>
</ul>
</li>
<li>
<p>动态修改表名：使用<code>Scopes</code></p>
<ul>
<li>
<p>用<code>Scopes</code>来动态添加条件</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">UserTable</span>(<span style="color:#a6e22e">user</span> <span style="color:#a6e22e">User</span>) <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
      <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Admin</span> {
        <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;admin_users&#34;</span>)
      }
                    
      <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>)
    }
  }
                    
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">UserTable</span>(<span style="color:#a6e22e">user</span>)).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>
<p>临时指定表名，使用<code>Table</code>方法临时指定表名</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#75715e">// 根据 User 的字段创建 `deleted_users` 表
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;deleted_users&#34;</span>).<span style="color:#a6e22e">AutoMigrate</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
</code></pre></div></li>
</ul>
</li>
<li>
<p>修改默认的命名策略：实现结构体的命名相关的接口</p>
<ul>
<li><code>TableName</code>、<code>ColumnName</code>、<code>JoinTableName</code>、<code>RelationshipFKName</code>、<code>CheckerName</code>、<code>IndexName</code>等接口</li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用字段名的<strong>下划线表示</strong>作为列名</p>
<ul>
<li>
<p>使用<code>column</code>标签或者<code>命名策略</code> 来指定列名</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Animal</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">AnimalID</span> <span style="color:#66d9ef">int64</span>  <span style="color:#e6db74">`gorm:&#34;column:beast_id&#34;`</span>         <span style="color:#75715e">// 将列名设为 `beast_id`
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Birthday</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span> <span style="color:#e6db74">`gorm:&#34;column:day_of_the_beast&#34;`</span> <span style="color:#75715e">// 将列名设为 `day_of_the_beast`
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Age</span>      <span style="color:#66d9ef">int64</span>     <span style="color:#e6db74">`gorm:&#34;column:age_of_the_beast&#34;`</span> <span style="color:#75715e">// 将列名设为 `age_of_the_beast`
</span><span style="color:#75715e"></span>  }
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>
<p>使用<code>CreatedAt</code>、<code>UpdatedAt</code> 字段追踪创建、更新时间</p>
<ul>
<li>
<p>CreatedAt字段的修改规则</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>) <span style="color:#75715e">// 将 `CreatedAt` 设为当前时间
</span><span style="color:#75715e"></span>                
  <span style="color:#a6e22e">user2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#a6e22e">CreatedAt</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()}
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user2</span>) <span style="color:#75715e">// user2 的 `CreatedAt` 不会被修改
</span><span style="color:#75715e"></span>                
  <span style="color:#75715e">// 想要修改该值，您可以使用 `Update`
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;CreatedAt&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>())
</code></pre></div></li>
</ul>
</li>
<li>
<p>UpdateAt字段的修改规则</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Save</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>) <span style="color:#75715e">// 将 `UpdatedAt` 设为当前时间
</span><span style="color:#75715e"></span>                
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>) <span style="color:#75715e">// 会将 `UpdatedAt` 设为当前时间
</span><span style="color:#75715e"></span>                
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">UpdateColumn</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>) <span style="color:#75715e">// `UpdatedAt` 不会被修改
</span><span style="color:#75715e"></span>                
  <span style="color:#a6e22e">user2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#a6e22e">UpdatedAt</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()}
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user2</span>) <span style="color:#75715e">// 创建记录时，user2 的 `UpdatedAt` 不会被修改
</span><span style="color:#75715e"></span>                
  <span style="color:#a6e22e">user3</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#a6e22e">UpdatedAt</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()}
  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Save</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user3</span>) <span style="color:#75715e">// 更新时，user3 的 `UpdatedAt` 会修改为当前时间
</span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>gorm.Model</code>默认的结构体，包含了默认的字段</p>
<ul>
<li>
<p>定义</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#75715e">// gorm.Model 的定义
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Model</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>        <span style="color:#66d9ef">uint</span>           <span style="color:#e6db74">`gorm:&#34;primaryKey&#34;`</span>
    <span style="color:#a6e22e">CreatedAt</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
    <span style="color:#a6e22e">UpdatedAt</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
    <span style="color:#a6e22e">DeletedAt</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DeletedAt</span> <span style="color:#e6db74">`gorm:&#34;index&#34;`</span>
  }
</code></pre></div></li>
</ul>
</li>
<li>
<p>可以嵌入到自己的结构体中以包含这些默认字段</p>
</li>
</ul>
</li>
<li>
<p>时间相关约定</p>
<ul>
<li>
<p>类型约定</p>
<ul>
<li>
<p><code>time.Time</code>，时间类型</p>
</li>
<li>
<p><code>int</code>，时间戳秒数</p>
</li>
<li>
<p><code>int64</code>，默认为时间戳秒数</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">    <span style="color:#a6e22e">Updated</span>  <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`gorm:&#34;autoUpdateTime:nano&#34;`</span> <span style="color:#75715e">//使用时间戳填纳秒数充更新时间
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Updated</span>  <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`gorm:&#34;autoUpdateTime:milli&#34;`</span> <span style="color:#75715e">//使用时间戳毫秒数填充更新时间
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">Created</span>  <span style="color:#66d9ef">int64</span> <span style="color:#e6db74">`gorm:&#34;autoCreateTime&#34;`</span>      <span style="color:#75715e">//使用时间戳秒数填充创建时间
</span></code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p>结构体嵌入</p>
<ul>
<li>
<p>匿名字段</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Model</span>
    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
  }
  <span style="color:#75715e">// 等效于
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>        <span style="color:#66d9ef">uint</span>           <span style="color:#e6db74">`gorm:&#34;primaryKey&#34;`</span>
    <span style="color:#a6e22e">CreatedAt</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
    <span style="color:#a6e22e">UpdatedAt</span> <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
    <span style="color:#a6e22e">DeletedAt</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DeletedAt</span> <span style="color:#e6db74">`gorm:&#34;index&#34;`</span>
    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
  }
</code></pre></div></li>
</ul>
</li>
<li>
<p>具名字段，使用标签<code>embedded</code>嵌入</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Author</span> <span style="color:#66d9ef">struct</span> {
      <span style="color:#a6e22e">Name</span>  <span style="color:#66d9ef">string</span>
      <span style="color:#a6e22e">Email</span> <span style="color:#66d9ef">string</span>
  }
                
  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Blog</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>      <span style="color:#66d9ef">int</span>
    <span style="color:#a6e22e">Author</span>  <span style="color:#a6e22e">Author</span> <span style="color:#e6db74">`gorm:&#34;embedded&#34;`</span>
    <span style="color:#a6e22e">Upvotes</span> <span style="color:#66d9ef">int32</span>
  }
  <span style="color:#75715e">// 等效于
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Blog</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>    <span style="color:#66d9ef">int64</span>
      <span style="color:#a6e22e">Name</span>  <span style="color:#66d9ef">string</span>
      <span style="color:#a6e22e">Email</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">Upvotes</span>  <span style="color:#66d9ef">int32</span>
  }
</code></pre></div></li>
<li>
<p>资源前缀修改,<code>embeddedPrefix</code>标签</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Blog</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>      <span style="color:#66d9ef">int</span>
    <span style="color:#a6e22e">Author</span>  <span style="color:#a6e22e">Author</span> <span style="color:#e6db74">`gorm:&#34;embedded;embeddedPrefix:author_&#34;`</span>
    <span style="color:#a6e22e">Upvotes</span> <span style="color:#66d9ef">int32</span>
  }
  <span style="color:#75715e">// 等效于
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Blog</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">ID</span>          <span style="color:#66d9ef">int64</span>
      <span style="color:#a6e22e">AuthorName</span>  <span style="color:#66d9ef">string</span>
      <span style="color:#a6e22e">AuthorEmail</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">Upvotes</span>     <span style="color:#66d9ef">int32</span>
  }
</code></pre></div></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><a href="https://learnku.com/docs/gorm/v2/models/9729#f87336#%E5%AD%97%E6%AE%B5%E6%A0%87%E7%AD%BE" target="_blank" rel="noopener noreferrer">字段标签</a>
</p>
</li>
<li>
<p><a href="https://learnku.com/docs/gorm/v2/associations/9740#tags" target="_blank" rel="noopener noreferrer">关联标签</a>
</p>
</li>
</ul>
</li>
</ol>
<h4 id="数据库连接">数据库连接<a class="anchor ms-1" href="#数据库连接"><i class="fas fa-link"></i></a></h4>
<h5 id="数据库驱动以及连接">数据库驱动以及连接<a class="anchor ms-1" href="#数据库驱动以及连接"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p>MYSQL</p>
<ul>
<li>
<p><a href="https://github.com/go-gorm/mysql" target="_blank" rel="noopener noreferrer">mysql高级配置</a>
</p>
</li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"> <span style="color:#f92672">import</span> (
   <span style="color:#e6db74">&#34;gorm.io/driver/mysql&#34;</span>
   <span style="color:#e6db74">&#34;gorm.io/gorm&#34;</span>
 )
        
 <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
   <span style="color:#75715e">// 参考 https://github.com/go-sql-driver/mysql#dsn-data-source-name 获取详情
</span><span style="color:#75715e"></span>   <span style="color:#a6e22e">dsn</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;user:pass@tcp(127.0.0.1:3306)/dbname?charset=utf8mb4&amp;parseTime=True&amp;loc=Local&#34;</span>
   <span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">mysql</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Config</span>{})
 }
</code></pre></div></li>
</ul>
</li>
<li>
<p>PostgreSQL</p>
<ul>
<li>
<p><a href="https://github.com/go-gorm/postgres" target="_blank" rel="noopener noreferrer">postgre高级配置</a>
</p>
</li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;gorm.io/driver/postgres&#34;</span>
    <span style="color:#e6db74">&#34;gorm.io/gorm&#34;</span>
  )
        
  <span style="color:#a6e22e">dsn</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;user=gorm password=gorm dbname=gorm port=9920 sslmode=disable TimeZone=Asia/Shanghai&#34;</span>
  <span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">postgres</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Config</span>{})
</code></pre></div></li>
</ul>
</li>
<li>
<p>SQLite</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;gorm.io/driver/sqlite&#34;</span>
    <span style="color:#e6db74">&#34;gorm.io/gorm&#34;</span>
  )
        
  <span style="color:#75715e">// github.com/mattn/go-sqlite3
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">sqlite</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#e6db74">&#34;gorm.db&#34;</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Config</span>{})
</code></pre></div></li>
</ul>
</li>
<li>
<p>SQL Server</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#f92672">import</span> (
    <span style="color:#e6db74">&#34;gorm.io/driver/sqlserver&#34;</span>
    <span style="color:#e6db74">&#34;gorm.io/gorm&#34;</span>
  )
        
  <span style="color:#75715e">// github.com/denisenkom/go-mssqldb
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">dsn</span> <span style="color:#f92672">:=</span> <span style="color:#e6db74">&#34;sqlserver://gorm:LoremIpsum86@localhost:9930?database=gorm&#34;</span>
  <span style="color:#a6e22e">db</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">sqlserver</span>.<span style="color:#a6e22e">Open</span>(<span style="color:#a6e22e">dsn</span>), <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Config</span>{})
</code></pre></div></li>
</ul>
</li>
</ul>
<h5 id="数据库连接池">数据库连接池<a class="anchor ms-1" href="#数据库连接池"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p><a href="https://pkg.go.dev/database/sql#DB" target="_blank" rel="noopener noreferrer">*sql.DB</a>
</p>
</li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#75715e">// 获取通用数据库对象 sql.DB，然后使用其提供的功能
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">DB</span>()
    
  <span style="color:#75715e">// Ping
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">Ping</span>()
    
  <span style="color:#75715e">// Close
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">Close</span>()
    
  <span style="color:#75715e">// 返回数据库统计信息
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">Stats</span>()
</code></pre></div></li>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">sqlDB</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">DB</span>()
    
  <span style="color:#75715e">// SetMaxIdleConns 设置空闲连接池中连接的最大数量
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">SetMaxIdleConns</span>(<span style="color:#ae81ff">10</span>)
    
  <span style="color:#75715e">// SetMaxOpenConns 设置打开数据库连接的最大数量。
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">SetMaxOpenConns</span>(<span style="color:#ae81ff">100</span>)
    
  <span style="color:#75715e">// SetConnMaxLifetime 设置了连接可复用的最大时间。
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">sqlDB</span>.<span style="color:#a6e22e">SetConnMaxLifetime</span>(<span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Hour</span>)
</code></pre></div></li>
</ul>
<h4 id="对象生命周期">对象生命周期<a class="anchor ms-1" href="#对象生命周期"><i class="fas fa-link"></i></a></h4>
<p>Hook 是在创建、查询、更新、删除等操作之前、之后调用的函数。</p>
<p>如果您已经为模型定义了指定的方法，它会在创建、更新、查询、删除时自动被调用。如果任何回调返回错误，GORM 将停止后续的操作并回滚事务。</p>
<h4 id="crud">CRUD<a class="anchor ms-1" href="#crud"><i class="fas fa-link"></i></a></h4>
<h5 id="创建">创建<a class="anchor ms-1" href="#创建"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p>创建记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;Jinzhu&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>, <span style="color:#a6e22e">Birthday</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>()}
  
<span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>) <span style="color:#75715e">// 通过数据的指针来创建
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">ID</span>             <span style="color:#75715e">// 返回插入数据的主键
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Error</span>        <span style="color:#75715e">// 返回 error
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">RowsAffected</span> <span style="color:#75715e">// 返回插入记录的条数
</span></code></pre></div><ul>
<li>将数据对象的制作传递给<code>Create</code>方法来进行创建</li>
<li>方法将会返回error以及插入的条数，同时数据对象的ID字段将会被回写</li>
</ul>
</li>
<li>
<p>插入指定的字段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>, <span style="color:#e6db74">&#34;CreatedAt&#34;</span>).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// INSERT INTO `users` (`name`,`age`,`created_at`) VALUES (&#34;jinzhu&#34;, 18, &#34;2020-07-04 11:05:21.775&#34;)
</span></code></pre></div><ul>
<li>创建记录，并且将选择的字段更新</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Omit</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>, <span style="color:#e6db74">&#34;CreatedAt&#34;</span>).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// INSERT INTO `users` (`birthday`,`updated_at`) VALUES (&#34;2020-01-01 00:00:00.000&#34;, &#34;2020-07-04 11:05:21.775&#34;)
</span></code></pre></div><ul>
<li>创建记录，并且更新未给出的字段</li>
</ul>
</li>
<li>
<p><strong>批量插入</strong>:使用<code>slice</code>传递给Create方法</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">users</span> = []<span style="color:#a6e22e">User</span>{{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu1&#34;</span>}, {<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>}, {<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu3&#34;</span>}}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">user</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">range</span> <span style="color:#a6e22e">users</span> {
  <span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">ID</span> <span style="color:#75715e">// 1,2,3
</span><span style="color:#75715e"></span>}
</code></pre></div></li>
<li>
<p><strong>批量插入</strong>:使用 <code>CreateInBatches</code> 创建，并支持<strong>指定创建的数量</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">users</span> = []<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">name</span>: <span style="color:#e6db74">&#34;jinzhu_1&#34;</span>}, <span style="color:#f92672">...</span>., {<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu_10000&#34;</span>}}
<span style="color:#75715e">// 数量为 100
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">CreateInBatches</span>(<span style="color:#a6e22e">users</span>, <span style="color:#ae81ff">100</span>)
</code></pre></div></li>
<li>
<p>对象Hook</p>
<ul>
<li>
<p>生命周期</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 开始事务
</span><span style="color:#75715e"></span><span style="color:#a6e22e">BeforeSave</span>
<span style="color:#a6e22e">BeforeCreate</span>
<span style="color:#75715e">// 关联前的 save
</span><span style="color:#75715e">// 插入记录至 db
</span><span style="color:#75715e">// 关联后的 save
</span><span style="color:#75715e"></span><span style="color:#a6e22e">AfterCreate</span>
<span style="color:#a6e22e">AfterSave</span>
<span style="color:#75715e">// 提交或回滚事务
</span></code></pre></div></li>
<li>
<p>跳过Hook，使用<code>SkipHooks</code> 会话模式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">DB</span>.<span style="color:#a6e22e">Session</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Session</span>{<span style="color:#a6e22e">SkipHooks</span>: <span style="color:#66d9ef">true</span>}).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
</code></pre></div></li>
</ul>
</li>
<li>
<p>根据 <code>map[string]interface{}</code> 和 <code>[]map[string]interface{}{}</code> 创建记录</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Create</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
    <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">18</span>,
  })
        
  <span style="color:#75715e">// batch insert from `[]map[string]interface{}{}`
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Create</span>([]<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
    {<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu_1&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">18</span>},
    {<span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu_2&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>: <span style="color:#ae81ff">20</span>},
  })
</code></pre></div></li>
</ul>
</li>
<li>
<p>使用<code>clause.Expr</code>创建记录</p>
<ul>
<li>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">  <span style="color:#75715e">// 通过 map 创建记录
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Create</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{
    <span style="color:#e6db74">&#34;Name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>,
    <span style="color:#e6db74">&#34;Location&#34;</span>: <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Expr</span>{<span style="color:#a6e22e">SQL</span>: <span style="color:#e6db74">&#34;ST_PointFromText(?)&#34;</span>, <span style="color:#a6e22e">Vars</span>: []<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;POINT(100 100)&#34;</span>}},
  })
  <span style="color:#75715e">// INSERT INTO `users` (`name`,`point`) VALUES (&#34;jinzhu&#34;,ST_PointFromText(&#34;POINT(100 100)&#34;));
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>关联创建</p>
<ul>
<li>
<p>如果两个数据结构有关联，那么在会把关联对象一起upsert</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">CreditCard</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Model</span>
  <span style="color:#a6e22e">Number</span>   <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">UserID</span>   <span style="color:#66d9ef">uint</span>
}
      
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Model</span>
  <span style="color:#a6e22e">Name</span>       <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">CreditCard</span> <span style="color:#a6e22e">CreditCard</span>
}
      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{
  <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>,
  <span style="color:#a6e22e">CreditCard</span>: <span style="color:#a6e22e">CreditCard</span>{<span style="color:#a6e22e">Number</span>: <span style="color:#e6db74">&#34;411111111111&#34;</span>}
})
<span style="color:#75715e">// INSERT INTO `users` ...
</span><span style="color:#75715e">// INSERT INTO `credit_cards` ...
</span></code></pre></div></li>
<li>
<p>skip 关联创建</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Omit</span>(<span style="color:#e6db74">&#34;CreditCard&#34;</span>).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// 跳过所有关联
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Omit</span>(<span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Associations</span>).<span style="color:#a6e22e">Create</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
</code></pre></div></li>
</ul>
</li>
<li>
<p>默认值,可以是值，也可以是数据库函数</p>
<ul>
<li>
<p>使用标签 <code>default</code> 为字段定义默认值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Mode</span>
  <span style="color:#a6e22e">Name</span> 		<span style="color:#66d9ef">string</span> 			<span style="color:#e6db74">`gorm:&#34;default:galeone&#34;`</span>
  <span style="color:#a6e22e">Weight</span>  	<span style="color:#66d9ef">int64</span>  			<span style="color:#e6db74">`gorm:&#34;default:18&#34;`</span>
  <span style="color:#a6e22e">Age</span>  		<span style="color:#f92672">*</span><span style="color:#66d9ef">int</span>       		<span style="color:#e6db74">`gorm:&#34;default:18&#34;`</span>
  <span style="color:#a6e22e">Active</span> 	<span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">NullBool</span> 	<span style="color:#e6db74">`gorm:&#34;default:true&#34;`</span>
}
</code></pre></div><ul>
<li>像 <code>0</code>、<code>''</code>、<code>false</code> 等零值，不会将这些字段定义的默认值保存到数据库。需要使用指针类型或 Scanner/Valuer 来避免这个问题</li>
</ul>
</li>
<li>
<p>当具有生成数据时，必须设置<code>default</code>标签</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">ID</span>        <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`gorm:&#34;default:uuid_generate_v3()&#34;`</span> <span style="color:#75715e">// 数据库函数
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">FirstName</span> <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">LastName</span>  <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Age</span>       <span style="color:#66d9ef">uint8</span>
  <span style="color:#a6e22e">FullName</span>  <span style="color:#66d9ef">string</span> <span style="color:#e6db74">`gorm:&#34;-&gt;;type:GENERATED ALWAYS AS (concat(firstname,&#39; &#39;,lastname));default:(-);`</span>
}
</code></pre></div></li>
</ul>
</li>
<li>
<p>Upsert及其冲突，<a href="https://learnku.com/docs/gorm/v2/create/9732#f43bde#Upsert%e5%8f%8a%e5%86%b2%e7%aa%81" target="_blank" rel="noopener noreferrer">相关链接</a>
</p>
<ul>
<li>出现冲突时，一般分为<strong>DoNothing</strong>，<strong>DoUpdates</strong>，<strong>UpdateAll</strong></li>
</ul>
</li>
</ul>
<h5 id="查询">查询<a class="anchor ms-1" href="#查询"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p>检索单个对象</p>
<ul>
<li>
<p><code>First</code>函数，按照主键升序获取第一条记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 获取第一条记录（主键升序）
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users ORDER BY id LIMIT 1;
</span></code></pre></div></li>
<li>
<p><code>Take</code>函数，不指定排序字段，获取第一条记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 获取一条记录，没有指定排序字段
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Take</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users LIMIT 1;
</span></code></pre></div></li>
<li>
<p><code>Last</code>函数，按照主键降序，获取第一条记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 获取最后一条记录（主键降序）
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Last</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users ORDER BY id DESC LIMIT 1;
</span></code></pre></div></li>
<li>
<p><code>First</code>，<code>Last</code>函数，仅在通过结构体和model值进行查询时才会生效，因为他需要使用结构体中的主键，或者是第一个字段来进行字段排序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user</span> <span style="color:#a6e22e">User</span>
      
<span style="color:#75715e">// 可以
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 可以
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
<span style="color:#75715e">// SELECT * FROM `users` ORDER BY `users`.`id` LIMIT 1
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 不行
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
      
<span style="color:#75715e">// 但可以配合 Take 使用
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Take</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
      
<span style="color:#75715e">// 根据第一个字段排序
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Language</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">Code</span> <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Language</span>{})
<span style="color:#75715e">// SELECT * FROM `languages` ORDER BY `languages`.`code` LIMIT 1
</span></code></pre></div></li>
<li>
<p>返回值，当成功时，返回找到的记录数，没有找到时，返回 <code>ErrRecordNotFound</code> 错误</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">RowsAffected</span> <span style="color:#75715e">// 返回找到的记录数
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Error</span>        <span style="color:#75715e">// returns error
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 检查 ErrRecordNotFound 错误
</span><span style="color:#75715e"></span><span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">Is</span>(<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Error</span>, <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">ErrRecordNotFound</span>)
</code></pre></div></li>
</ul>
</li>
<li>
<p>根据主键查询</p>
<ul>
<li>
<p><strong>内联条件</strong>检索</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>, <span style="color:#ae81ff">10</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE id = 10;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>, <span style="color:#e6db74">&#34;10&#34;</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE id = 10;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>, []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>})
<span style="color:#75715e">// SELECT * FROM users WHERE id IN (1,2,3);
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>检索全部对象</p>
<ul>
<li>
<p><code>Find</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 获取全部记录
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">RowsAffected</span> <span style="color:#75715e">// 返回找到的记录数，相当于 `len(users)`
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Error</span>        <span style="color:#75715e">// returns error
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>检索条件</p>
<ul>
<li>
<p><code>Where</code>函数，支持string类型的条件以及struct&amp;Map类型的条件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 获取第一条匹配的记录
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name = &#39;jinzhu&#39; ORDER BY id LIMIT 1;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 获取全部匹配的记录
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name &lt;&gt; ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name &lt;&gt; &#39;jinzhu&#39;;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// IN
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name IN ?&#34;</span>, []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name IN (&#39;jinzhu&#39;,&#39;jinzhu 2&#39;);
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// LIKE
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name LIKE ?&#34;</span>, <span style="color:#e6db74">&#34;%jin%&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name LIKE &#39;%jin%&#39;;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// AND
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ? AND age &gt;= ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#e6db74">&#34;22&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name = &#39;jinzhu&#39; AND age &gt;= 22;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// Time
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;updated_at &gt; ?&#34;</span>, <span style="color:#a6e22e">lastWeek</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE updated_at &gt; &#39;2000-01-01 00:00:00&#39;;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// BETWEEN
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;created_at BETWEEN ? AND ?&#34;</span>, <span style="color:#a6e22e">lastWeek</span>, <span style="color:#a6e22e">today</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE created_at BETWEEN &#39;2000-01-01 00:00:00&#39; AND &#39;2000-01-08 00:00:00&#39;;
</span></code></pre></div></li>
<li>
<p>Not条件，使用<code>Not</code>函数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Not</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE NOT name = &#34;jinzhu&#34; ORDER BY id LIMIT 1;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// Not In
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Not</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>}}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name NOT IN (&#34;jinzhu&#34;, &#34;jinzhu 2&#34;);
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// Struct
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Not</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>}).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name &lt;&gt; &#34;jinzhu&#34; AND age &lt;&gt; 18 ORDER BY id LIMIT 1;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 不在主键切片中的记录
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Not</span>([]<span style="color:#66d9ef">int64</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>}).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE id NOT IN (1,2,3) ORDER BY id LIMIT 1;
</span></code></pre></div></li>
<li>
<p>Or条件，使用<code>Or</code>函数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">Selectdb</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;role = ?&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>).<span style="color:#a6e22e">Or</span>(<span style="color:#e6db74">&#34;role = ?&#34;</span>, <span style="color:#e6db74">&#34;super_admin&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE role = &#39;admin&#39; OR role = &#39;super_admin&#39;;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// Struct
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = &#39;jinzhu&#39;&#34;</span>).<span style="color:#a6e22e">Or</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name = &#39;jinzhu&#39; OR (name = &#39;jinzhu 2&#39; AND age = 18);
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// Map
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = &#39;jinzhu&#39;&#34;</span>).<span style="color:#a6e22e">Or</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name = &#39;jinzhu&#39; OR (name = &#39;jinzhu 2&#39; AND age = 18);
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Struct&amp;Map条件</p>
<pre><code>  ```go
  // Struct
  db.Where(&amp;User{Name: &quot;jinzhu&quot;, Age: 20}).First(&amp;user)
  // SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20 ORDER BY id LIMIT 1;
    
  // Map
  db.Where(map[string]interface{}{&quot;name&quot;: &quot;jinzhu&quot;, &quot;age&quot;: 20}).Find(&amp;users)
  // SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 20;
    
  // 主键切片条件
  db.Where([]int64{20, 21, 22}).Find(&amp;users)
  // SELECT * FROM users WHERE id IN (20, 21, 22);
</code></pre>
<pre><code>  
- 在使用**结构体**查询时，GORM只会查询非零值字段，当查询字段值为 `0`、`''`、`false` 或其他 [零值](https://tour.golang.org/basics/12)，该字段不会被用于构建查询条件
  
        ```go
        db.Where(&amp;User{Name: &quot;jinzhu&quot;, Age: 0}).Find(&amp;users)
        // SELECT * FROM users WHERE name = &quot;jinzhu&quot;;
</code></pre><ul>
<li>
<p>可以<strong>使用<code>map</code>来构建</strong>该类零值查询条件</p>
<pre><code>  ```go
  db.Where(map[string]interface{}{&quot;Name&quot;: &quot;jinzhu&quot;, &quot;Age&quot;: 0}).Find(&amp;users)
  // SELECT * FROM users WHERE name = &quot;jinzhu&quot; AND age = 0;
  ```
</code></pre>
</li>
<li>
<p>内联条件,即<code>不使用Where</code>函数完成查询</p>
<pre><code>  ```go
  // SELECT * FROM users WHERE id = 23;
  // 根据主键获取记录，如果是非整型主键
  db.First(&amp;user, &quot;id = ?&quot;, &quot;string_primary_key&quot;)
  // SELECT * FROM users WHERE id = 'string_primary_key';
        
  // Plain SQL
  db.Find(&amp;user, &quot;name = ?&quot;, &quot;jinzhu&quot;)
  // SELECT * FROM users WHERE name = &quot;jinzhu&quot;;
        
  db.Find(&amp;users, &quot;name &lt;&gt; ? AND age &gt; ?&quot;, &quot;jinzhu&quot;, 20)
  // SELECT * FROM users WHERE name &lt;&gt; &quot;jinzhu&quot; AND age &gt; 20;
        
  // Struct
  db.Find(&amp;users, User{Age: 20})
  // SELECT * FROM users WHERE age = 20;
        
  // Map
  db.Find(&amp;users, map[string]interface{}{&quot;age&quot;: 20})
  // SELECT * FROM users WHERE age = 20;
  ```
</code></pre>
</li>
</ul>
</li>
<li>
<p><strong>字段选择</strong></p>
<ul>
<li>
<p>Select，<strong>选择特定字段</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT name, age FROM users;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Select</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT name, age FROM users;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;COALESCE(age,?)&#34;</span>, <span style="color:#ae81ff">42</span>).<span style="color:#a6e22e">Rows</span>()
<span style="color:#75715e">// SELECT COALESCE(age,&#39;42&#39;) FROM users;
</span></code></pre></div></li>
<li>
<p><strong>智能选择字段</strong>，通过定义一个查询结构体，在调用时自动选择字段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">User</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">ID</span>     <span style="color:#66d9ef">uint</span>
  <span style="color:#a6e22e">Name</span>   <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Age</span>    <span style="color:#66d9ef">int</span>
  <span style="color:#a6e22e">Gender</span> <span style="color:#66d9ef">string</span>
  <span style="color:#75715e">// 假设后面还有几百个字段...
</span><span style="color:#75715e"></span>}
      
<span style="color:#75715e">//查询字段的小结构体
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">APIUser</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">ID</span>   <span style="color:#66d9ef">uint</span>
  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
}
      
<span style="color:#75715e">// 查询时会自动选择 `id`, `name` 字段
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Limit</span>(<span style="color:#ae81ff">10</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">APIUser</span>{})
<span style="color:#75715e">// SELECT `id`, `name` FROM `users` LIMIT 10
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Order</strong>，指定数据库检索记录时的排序方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Order</span>(<span style="color:#e6db74">&#34;age desc, name&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users ORDER BY age desc, name;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 多个 order
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Order</span>(<span style="color:#e6db74">&#34;age desc&#34;</span>).<span style="color:#a6e22e">Order</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users ORDER BY age desc, name;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">OrderBy</span>{
  <span style="color:#a6e22e">Expression</span>: <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Expr</span>{<span style="color:#a6e22e">SQL</span>: <span style="color:#e6db74">&#34;FIELD(id,?)&#34;</span>, <span style="color:#a6e22e">Vars</span>: []<span style="color:#66d9ef">interface</span>{}{[]<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>}}, <span style="color:#a6e22e">WithoutParentheses</span>: <span style="color:#66d9ef">true</span>},
}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * FROM users ORDER BY FIELD(id,1,2,3)
</span></code></pre></div><ul>
<li><code>Order</code>就是<code>order by</code>语句，所以当<code>Order</code>函数后接<code>First</code>函数或者<code>Last</code>时，<code>First</code>和<code>Last</code>的order将会失效</li>
</ul>
</li>
<li>
<p><strong>Limit &amp; Offset</strong>函数，并且可以通过传值为<code>-1</code>重置这些条件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Limit</span>(<span style="color:#ae81ff">3</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users LIMIT 3;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 通过 -1 消除 Limit 条件
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Limit</span>(<span style="color:#ae81ff">10</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users1</span>).<span style="color:#a6e22e">Limit</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users2</span>)
<span style="color:#75715e">// SELECT * FROM users LIMIT 10; (users1)
</span><span style="color:#75715e">// SELECT * FROM users; (users2)
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Offset</span>(<span style="color:#ae81ff">3</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users OFFSET 3;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Limit</span>(<span style="color:#ae81ff">10</span>).<span style="color:#a6e22e">Offset</span>(<span style="color:#ae81ff">5</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users OFFSET 5 LIMIT 10;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 通过 -1 消除 Offset 条件
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Offset</span>(<span style="color:#ae81ff">10</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users1</span>).<span style="color:#a6e22e">Offset</span>(<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users2</span>)
<span style="color:#75715e">// SELECT * FROM users OFFSET 10; (users1)
</span><span style="color:#75715e">// SELECT * FROM users; (users2)
</span></code></pre></div><ul>
<li>
<p>分页查询器</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">Paginate</span>(<span style="color:#a6e22e">r</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">http</span>.<span style="color:#a6e22e">Request</span>) <span style="color:#66d9ef">func</span>(<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
    <span style="color:#75715e">//此处应该传入page_num,page_size,而不是使用*http.Request类型
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">page</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;page&#34;</span>))
    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">page</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span> {
      <span style="color:#a6e22e">page</span> = <span style="color:#ae81ff">1</span>
    }
      
    <span style="color:#a6e22e">pageSize</span>, <span style="color:#a6e22e">_</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">strconv</span>.<span style="color:#a6e22e">Atoi</span>(<span style="color:#a6e22e">r</span>.<span style="color:#a6e22e">Query</span>(<span style="color:#e6db74">&#34;page_size&#34;</span>))
    <span style="color:#66d9ef">switch</span> {
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">pageSize</span> &gt; <span style="color:#ae81ff">100</span>:
      <span style="color:#a6e22e">pageSize</span> = <span style="color:#ae81ff">100</span>
    <span style="color:#66d9ef">case</span> <span style="color:#a6e22e">pageSize</span> <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">0</span>:
      <span style="color:#a6e22e">pageSize</span> = <span style="color:#ae81ff">10</span>
    }
      
    <span style="color:#a6e22e">offset</span> <span style="color:#f92672">:=</span> (<span style="color:#a6e22e">page</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> <span style="color:#a6e22e">pageSize</span>
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Offset</span>(<span style="color:#a6e22e">offset</span>).<span style="color:#a6e22e">Limit</span>(<span style="color:#a6e22e">pageSize</span>)
  }
}
      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">Paginate</span>(<span style="color:#a6e22e">r</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">Paginate</span>(<span style="color:#a6e22e">r</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">articles</span>)
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Group  &amp; Having</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">result</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">Date</span>  <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Time</span>
  <span style="color:#a6e22e">Total</span> <span style="color:#66d9ef">int</span>
}
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name, sum(age) as total&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name LIKE ?&#34;</span>, <span style="color:#e6db74">&#34;group%&#34;</span>).<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
<span style="color:#75715e">// SELECT name, sum(age) as total FROM `users` WHERE name LIKE &#34;group%&#34; GROUP BY `name`
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name, sum(age) as total&#34;</span>).<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">Having</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;group&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
<span style="color:#75715e">// SELECT name, sum(age) as total FROM `users` GROUP BY `name` HAVING name = &#34;group
</span></code></pre></div></li>
<li>
<p><strong>Distinct</strong>，从模型中选择不想同的值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Distinct</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>).<span style="color:#a6e22e">Order</span>(<span style="color:#e6db74">&#34;name, age desc&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">results</span>)
</code></pre></div></li>
<li>
<p><strong>Joins</strong>，感觉像脱裤子放屁，都写到这个份上了，还不如直接写SQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">result</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">Name</span>  <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Email</span> <span style="color:#66d9ef">string</span>
}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;users.name, emails.email&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;left join emails on emails.user_id = users.id&#34;</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>{})
<span style="color:#75715e">// SELECT users.name, emails.email FROM `users` left join emails on emails.user_id = users.id
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">rows</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;users.name, emails.email&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;left join emails on emails.user_id = users.id&#34;</span>).<span style="color:#a6e22e">Rows</span>()
<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">rows</span>.<span style="color:#a6e22e">Next</span>() {
  <span style="color:#f92672">...</span>
}
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;users.name, emails.email&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;left join emails on emails.user_id = users.id&#34;</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">results</span>)
  
<span style="color:#75715e">// 带参数的多表连接
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;JOIN emails ON emails.user_id = users.id AND emails.email = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu@example.org&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;JOIN credit_cards ON credit_cards.user_id = users.id&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;credit_cards.number = ?&#34;</span>, <span style="color:#e6db74">&#34;411111111111&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
</code></pre></div><ul>
<li>
<p>Joins预加载，<code>Joins Predlaod</code>会使用inner join加载相关数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Company&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Manager&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Account&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>, <span style="color:#ae81ff">1</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Company&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Manager&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Account&#34;</span>).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>, <span style="color:#e6db74">&#34;users.name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Company&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Manager&#34;</span>).<span style="color:#a6e22e">Joins</span>(<span style="color:#e6db74">&#34;Account&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>, <span style="color:#e6db74">&#34;users.id IN ?&#34;</span>, []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>,<span style="color:#ae81ff">4</span>,<span style="color:#ae81ff">5</span>})
</code></pre></div></li>
</ul>
</li>
<li>
<p><strong>Count</strong>，用于获取匹配的记录数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">count</span> <span style="color:#66d9ef">int64</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">Or</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>).<span style="color:#a6e22e">Count</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">count</span>)
<span style="color:#75715e">// SELECT count(1) FROM users WHERE name = &#39;jinzhu&#39; OR name = &#39;jinzhu 2&#39;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">Count</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">count</span>)
<span style="color:#75715e">// SELECT count(1) FROM users WHERE name = &#39;jinzhu&#39;; (count)
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;deleted_users&#34;</span>).<span style="color:#a6e22e">Count</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">count</span>)
<span style="color:#75715e">// SELECT count(1) FROM deleted_users;
</span></code></pre></div></li>
<li>
<p><strong>Scan</strong>，扫描结果到结构体中，用法和Find类似</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Result</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>
}
  
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#a6e22e">Result</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;Antonio&#34;</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
  
<span style="color:#75715e">// 使用原生SQL时，利用Scan扫描数据
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;SELECT name, age FROM users WHERE name = ?&#34;</span>, <span style="color:#e6db74">&#34;Antonio&#34;</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
</code></pre></div></li>
<li>
<p><strong>Rows</strong>，支持通过行进行迭代</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">rows</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">Rows</span>()
<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">rows</span>.<span style="color:#a6e22e">Close</span>()
  
<span style="color:#66d9ef">for</span> <span style="color:#a6e22e">rows</span>.<span style="color:#a6e22e">Next</span>() {
  <span style="color:#66d9ef">var</span> <span style="color:#a6e22e">user</span> <span style="color:#a6e22e">User</span>
  <span style="color:#75715e">// ScanRows 方法用于将一行记录扫描至结构体
</span><span style="color:#75715e"></span>  <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">ScanRows</span>(<span style="color:#a6e22e">rows</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
}
</code></pre></div></li>
<li>
<p>命名参数，通过</p>
</li>
<li>
<p>可嵌套的子查询，查询语句可以嵌套，形成子查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;amount &gt; (?)&#34;</span>, <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;orders&#34;</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;AVG(amount)&#34;</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">orders</span>)
<span style="color:#75715e">// SELECT * FROM &#34;orders&#34; WHERE amount &gt; (SELECT AVG(amount) FROM &#34;orders&#34;);
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">subQuery</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;AVG(age)&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name LIKE ?&#34;</span>, <span style="color:#e6db74">&#34;name%&#34;</span>).<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;AVG(age) as avgage&#34;</span>).<span style="color:#a6e22e">Group</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">Having</span>(<span style="color:#e6db74">&#34;AVG(age) &gt; (?)&#34;</span>, <span style="color:#a6e22e">subQuery</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">results</span>)
<span style="color:#75715e">// SELECT AVG(age) as avgage FROM `users` GROUP BY `name` HAVING AVG(age) &gt; (SELECT AVG(age) FROM `users` WHERE name LIKE &#34;name%&#34;)
</span></code></pre></div><ul>
<li>
<p>将嵌套的条件，Group可以实现很复杂的SQL，但是为什么不直接使用原生SQL呢？</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(
    <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;pizza = ?&#34;</span>, <span style="color:#e6db74">&#34;pepperoni&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;size = ?&#34;</span>, <span style="color:#e6db74">&#34;small&#34;</span>).<span style="color:#a6e22e">Or</span>(<span style="color:#e6db74">&#34;size = ?&#34;</span>, <span style="color:#e6db74">&#34;medium&#34;</span>)),
).<span style="color:#a6e22e">Or</span>(
    <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;pizza = ?&#34;</span>, <span style="color:#e6db74">&#34;hawaiian&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;size = ?&#34;</span>, <span style="color:#e6db74">&#34;xlarge&#34;</span>),
).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Pizza</span>{}).<span style="color:#a6e22e">Statement</span>
      
<span style="color:#75715e">// SELECT * FROM `pizzas` WHERE (pizza = &#34;pepperoni&#34; AND (size = &#34;small&#34; OR size = &#34;medium&#34;)) OR (pizza = &#34;hawaiian&#34; AND size = &#34;xlarge&#34;)
</span></code></pre></div></li>
</ul>
</li>
<li>
<p><strong>From</strong>子查询,允许在<code>Table</code>方法中嵌套一条新的查询语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;(?) as u&#34;</span>, <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>)).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;age = ?&#34;</span>, <span style="color:#ae81ff">18</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * FROM (SELECT `name`,`age` FROM `users`) as u WHERE `age` = 18
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">subQuery1</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>)
<span style="color:#a6e22e">subQuery2</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Pet</span>{}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;(?) as u, (?) as p&#34;</span>, <span style="color:#a6e22e">subQuery1</span>, <span style="color:#a6e22e">subQuery2</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * FROM (SELECT `name` FROM `users`) as u, (SELECT `name` FROM `pets`) as p
</span></code></pre></div></li>
<li>
<p><strong>Find</strong>至map，通过指定 <code>Model</code> 或 <code>Table</code>，扫描至 <code>map[string]interface{}</code> 或 <code>[]map[string]interface{}</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>, <span style="color:#e6db74">&#34;id = ?&#34;</span>, <span style="color:#ae81ff">1</span>)
  
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">results</span> []<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">results</span>)
</code></pre></div></li>
<li>
<p>Pluck，将单列数据，查询后返回到切片中</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">ages</span> []<span style="color:#66d9ef">int64</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>).<span style="color:#a6e22e">Pluck</span>(<span style="color:#e6db74">&#34;age&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">ages</span>)
  
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">names</span> []<span style="color:#66d9ef">string</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Pluck</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">names</span>)
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;deleted_users&#34;</span>).<span style="color:#a6e22e">Pluck</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">names</span>)
  
<span style="color:#75715e">// Distinct Pluck
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Distinct</span>().<span style="color:#a6e22e">Pluck</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">names</span>)
<span style="color:#75715e">// SELECT DISTINCT `name` FROM `users`
</span></code></pre></div></li>
<li>
<p>Scopes，通过将常用的查询，实现为一种接口，就可以在Scopes中进行调用，方便查询</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">AmountGreaterThan1000</span>(<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;amount &gt; ?&#34;</span>, <span style="color:#ae81ff">1000</span>)
}
  
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">PaidWithCreditCard</span>(<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;pay_mode_sign = ?&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>)
}
  
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">PaidWithCod</span>(<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;pay_mode_sign = ?&#34;</span>, <span style="color:#e6db74">&#34;C&#34;</span>)
}
  
<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">OrderStatus</span>(<span style="color:#a6e22e">status</span> []<span style="color:#66d9ef">string</span>) <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span> {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;status IN (?)&#34;</span>, <span style="color:#a6e22e">status</span>)
  }
}
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">AmountGreaterThan1000</span>, <span style="color:#a6e22e">PaidWithCreditCard</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">orders</span>)
<span style="color:#75715e">// 查找所有金额大于 1000 的信用卡订单
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">AmountGreaterThan1000</span>, <span style="color:#a6e22e">PaidWithCod</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">orders</span>)
<span style="color:#75715e">// 查找所有金额大于 1000 的货到付款订单
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Scopes</span>(<span style="color:#a6e22e">AmountGreaterThan1000</span>, <span style="color:#a6e22e">OrderStatus</span>([]<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;paid&#34;</span>, <span style="color:#e6db74">&#34;shipped&#34;</span>})).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">orders</span>)
<span style="color:#75715e">// 查找所有金额大于 1000 且已付款或已发货的订单
</span></code></pre></div></li>
<li>
<p>优化查询计划</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;gorm.io/hints&#34;</span>
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;MAX_EXECUTION_TIME(10000)&#34;</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * /*+ MAX_EXECUTION_TIME(10000) */ FROM `users`
</span></code></pre></div></li>
<li>
<p>指定索引</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">import</span> <span style="color:#e6db74">&#34;gorm.io/hints&#34;</span>
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">UseIndex</span>(<span style="color:#e6db74">&#34;idx_user_name&#34;</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * FROM `users` USE INDEX (`idx_user_name`)
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">hints</span>.<span style="color:#a6e22e">ForceIndex</span>(<span style="color:#e6db74">&#34;idx_user_name&#34;</span>, <span style="color:#e6db74">&#34;idx_user_id&#34;</span>).<span style="color:#a6e22e">ForJoin</span>()).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// SELECT * FROM `users` FORCE INDEX FOR JOIN (`idx_user_name`,`idx_user_id`)&#34;
</span></code></pre></div></li>
<li>
<p>Hook，查询操作，支持<code>AfterFind</code>hook，查询记录时会调用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">AfterFind</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Role</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
    <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Role</span> = <span style="color:#e6db74">&#34;user&#34;</span>
  }
  <span style="color:#66d9ef">return</span>
}
</code></pre></div></li>
<li>
<p>查询控制，针对查询结果执行额外的任务<a href="https://learnku.com/docs/gorm/v2/advanced_query/9757#88c728" target="_blank" rel="noopener noreferrer">查询控制</a>
</p>
</li>
<li>
<p>原生SQL查询</p>
<ul>
<li>
<p><code>Raw</code>形式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Result</span> <span style="color:#66d9ef">struct</span> {
  <span style="color:#a6e22e">ID</span>   <span style="color:#66d9ef">int</span>
  <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
  <span style="color:#a6e22e">Age</span>  <span style="color:#66d9ef">int</span>
}
      
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">result</span> <span style="color:#a6e22e">Result</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;SELECT id, name, age FROM users WHERE id = ?&#34;</span>, <span style="color:#ae81ff">3</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>)
      
<span style="color:#66d9ef">var</span> <span style="color:#a6e22e">age</span> <span style="color:#66d9ef">int</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;select sum(age) from users where role = ?&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>).<span style="color:#a6e22e">Scan</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">age</span>)
</code></pre></div></li>
<li>
<p><code>Exec</code>函数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;DROP TABLE users&#34;</span>)
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;UPDATE orders SET shipped_at=? WHERE id IN ?&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>(), []<span style="color:#66d9ef">int64</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>})
      
<span style="color:#75715e">// Exec SQL 表达式
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;update users set money=? where name = ?&#34;</span>, <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Expr</span>(<span style="color:#e6db74">&#34;money * ? + ?&#34;</span>, <span style="color:#ae81ff">10000</span>, <span style="color:#ae81ff">1</span>), <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
</code></pre></div></li>
<li>
<p>命名参数，支持在<code>Where</code>，<code>Raw</code>,<code>Exec</code>等函数中使用，效果同上</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name1 = @name OR name2 = @name&#34;</span>, <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Named</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM `users` WHERE name1 = &#34;jinzhu&#34; OR name2 = &#34;jinzhu&#34;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;name1 = @name OR name2 = @name&#34;</span>, <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>}).<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result3</span>)
<span style="color:#75715e">// SELECT * FROM `users` WHERE name1 = &#34;jinzhu2&#34; OR name2 = &#34;jinzhu2&#34; ORDER BY `users`.`id` LIMIT 1
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 原生 SQL 及命名参数
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;SELECT * FROM users WHERE name1 = @name OR name2 = @name2 OR name3 = @name&#34;</span>,
   <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Named</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu1&#34;</span>), <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Named</span>(<span style="color:#e6db74">&#34;name2&#34;</span>, <span style="color:#e6db74">&#34;jinzhu2&#34;</span>)).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE name1 = &#34;jinzhu1&#34; OR name2 = &#34;jinzhu2&#34; OR name3 = &#34;jinzhu1&#34;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;UPDATE users SET name1 = @name, name2 = @name2, name3 = @name&#34;</span>,
   <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Named</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhunew&#34;</span>), <span style="color:#a6e22e">sql</span>.<span style="color:#a6e22e">Named</span>(<span style="color:#e6db74">&#34;name2&#34;</span>, <span style="color:#e6db74">&#34;jinzhunew2&#34;</span>))
<span style="color:#75715e">// UPDATE users SET name1 = &#34;jinzhunew&#34;, name2 = &#34;jinzhunew2&#34;, name3 = &#34;jinzhunew&#34;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;SELECT * FROM users WHERE (name1 = @name AND name3 = @name) AND name2 = @name2&#34;</span>,
   <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#e6db74">&#34;name2&#34;</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE (name1 = &#34;jinzhu&#34; AND name3 = &#34;jinzhu&#34;) AND name2 = &#34;jinzhu2&#34;
</span><span style="color:#75715e"></span>      
<span style="color:#66d9ef">type</span> <span style="color:#a6e22e">NamedArgument</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">Name</span> <span style="color:#66d9ef">string</span>
    <span style="color:#a6e22e">Name2</span> <span style="color:#66d9ef">string</span>
}
      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Raw</span>(<span style="color:#e6db74">&#34;SELECT * FROM users WHERE (name1 = @Name AND name3 = @Name) AND name2 = @Name2&#34;</span>,
     <span style="color:#a6e22e">NamedArgument</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>, <span style="color:#a6e22e">Name2</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE (name1 = &#34;jinzhu&#34; AND name3 = &#34;jinzhu&#34;) AND name2 = &#34;jinzhu2&#34;
</span></code></pre></div></li>
</ul>
</li>
</ul>
<h5 id="更新">更新<a class="anchor ms-1" href="#更新"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p><code>Save</code>,<strong>保存所有字段</strong>，即使字段是零值</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">First</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
  
<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Name</span> = <span style="color:#e6db74">&#34;jinzhu 2&#34;</span>
<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Age</span> = <span style="color:#ae81ff">100</span>
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Save</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// UPDATE users SET name=&#39;jinzhu 2&#39;, age=100, birthday=&#39;2016-01-01&#39;, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></code></pre></div></li>
<li>
<p>使用<code>Select</code>,<code>Omit</code>函数，在<code>struct</code>或者<code>map[string]interface{}</code><strong>更新选定字段</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// Select 和 Map
</span><span style="color:#75715e">// User&#39;s ID is `111`:
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;actived&#34;</span>: <span style="color:#66d9ef">false</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39; WHERE id=111;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Omit</span>(<span style="color:#e6db74">&#34;name&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;actived&#34;</span>: <span style="color:#66d9ef">false</span>})
<span style="color:#75715e">// UPDATE users SET age=18, actived=false, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// Select 和 Struct （可以选中更新零值字段）
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">result</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Age&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;new_name&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">0</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;new_name&#39;, age=0 WHERE id=111;
</span></code></pre></div></li>
<li>
<p><code>Update</code>，更新单列</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 条件更新
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;active = ?&#34;</span>, <span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;hello&#34;</span>)
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE active=true;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// User 的 ID 是 `111`
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;hello&#34;</span>)
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 根据条件和 model 的值进行更新
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;active = ?&#34;</span>, <span style="color:#66d9ef">true</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;hello&#34;</span>)
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111 AND active=true;
</span></code></pre></div><ul>
<li>注意点：需要指定条件进行更新，否则会返回<code>ErrMissingWhereClause</code> 错误</li>
</ul>
</li>
<li>
<p>Updates，更新多列，支持struct和map[string]interface{} 作为参数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 根据 `struct` 更新属性，只会更新非零值的字段
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>, <span style="color:#a6e22e">Active</span>: <span style="color:#66d9ef">false</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18, updated_at = &#39;2013-11-17 21:34:10&#39; WHERE id = 111;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 根据 `map` 更新属性
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;actived&#34;</span>: <span style="color:#66d9ef">false</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18, actived=false, updated_at=&#39;2013-11-17 21:34:10&#39; WHERE id=111;
</span></code></pre></div><ul>
<li>
<p>获取受影响的行数，Updates返回更新的记录数和更新时发生的异常</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 通过 `RowsAffected` 得到更新的记录数
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;role = ?&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE role = &#39;admin;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">RowsAffected</span> <span style="color:#75715e">// 更新的记录数
</span><span style="color:#75715e"></span><span style="color:#a6e22e">result</span>.<span style="color:#a6e22e">Error</span>        <span style="color:#75715e">// 更新的错误
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>批量更新，当数据对象<code>Model</code>中<strong>没有指定主键</strong>，那么就会更新条件中的全部记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 根据 struct 更新
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;role = ?&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE role = &#39;admin;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 根据 map 更新
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Table</span>(<span style="color:#e6db74">&#34;users&#34;</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;id IN ?&#34;</span>, []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">11</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE id IN (10, 11);
</span></code></pre></div></li>
<li>
<p>强制全局更新，默认GORM不会执行为加条件的批量更新，因此需要使用原生SQL或者加一些额外的条件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>).<span style="color:#a6e22e">Error</span> <span style="color:#75715e">// gorm.ErrMissingWhereClause
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;1 = 1&#34;</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
<span style="color:#75715e">// UPDATE users SET `name` = &#34;jinzhu&#34; WHERE 1=1
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;UPDATE users SET name = ?&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
<span style="color:#75715e">// UPDATE users SET name = &#34;jinzhu&#34;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Session</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Session</span>{<span style="color:#a6e22e">AllowGlobalUpdate</span>: <span style="color:#66d9ef">true</span>}).<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
<span style="color:#75715e">// UPDATE users SET `name` = &#34;jinzhu&#34;
</span></code></pre></div></li>
<li>
<p>使用SQL表达式和<code>Context Valuer</code>更新列</p>
<ul>
<li>
<p>SQL表达式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// product 的 ID 是 `3`
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">product</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;price&#34;</span>, <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Expr</span>(<span style="color:#e6db74">&#34;price * ? + ?&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">100</span>))
<span style="color:#75715e">// UPDATE &#34;products&#34; SET &#34;price&#34; = price * 2 + 100, &#34;updated_at&#34; = &#39;2013-11-17 21:34:10&#39; WHERE &#34;id&#34; = 3;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">product</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{}{<span style="color:#e6db74">&#34;price&#34;</span>: <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Expr</span>(<span style="color:#e6db74">&#34;price * ? + ?&#34;</span>, <span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">100</span>)})
<span style="color:#75715e">// UPDATE &#34;products&#34; SET &#34;price&#34; = price * 2 + 100, &#34;updated_at&#34; = &#39;2013-11-17 21:34:10&#39; WHERE &#34;id&#34; = 3;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">product</span>).<span style="color:#a6e22e">UpdateColumn</span>(<span style="color:#e6db74">&#34;quantity&#34;</span>, <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Expr</span>(<span style="color:#e6db74">&#34;quantity - ?&#34;</span>, <span style="color:#ae81ff">1</span>))
<span style="color:#75715e">// UPDATE &#34;products&#34; SET &#34;quantity&#34; = quantity - 1 WHERE &#34;id&#34; = 3;
</span><span style="color:#75715e"></span>      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">product</span>).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;quantity &gt; 1&#34;</span>).<span style="color:#a6e22e">UpdateColumn</span>(<span style="color:#e6db74">&#34;quantity&#34;</span>, <span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Expr</span>(<span style="color:#e6db74">&#34;quantity - ?&#34;</span>, <span style="color:#ae81ff">1</span>))
<span style="color:#75715e">// UPDATE &#34;products&#34; SET &#34;quantity&#34; = quantity - 1 WHERE &#34;id&#34; = 3 AND quantity &gt; 1;
</span></code></pre></div></li>
<li>
<p><code>Context Valuer</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 根据自定义数据类型创建
</span><span style="color:#75715e"></span><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">Location</span> <span style="color:#66d9ef">struct</span> {
    <span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">Y</span> <span style="color:#66d9ef">int</span>
}
      
<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">loc</span> <span style="color:#a6e22e">Location</span>) <span style="color:#a6e22e">GormValue</span>(<span style="color:#a6e22e">ctx</span> <span style="color:#a6e22e">context</span>.<span style="color:#a6e22e">Context</span>, <span style="color:#a6e22e">db</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Expr</span> {
  <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Expr</span>{
    <span style="color:#a6e22e">SQL</span>:  <span style="color:#e6db74">&#34;ST_PointFromText(?)&#34;</span>,
    <span style="color:#a6e22e">Vars</span>: []<span style="color:#66d9ef">interface</span>{}{<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;POINT(%d %d)&#34;</span>, <span style="color:#a6e22e">loc</span>.<span style="color:#a6e22e">X</span>, <span style="color:#a6e22e">loc</span>.<span style="color:#a6e22e">Y</span>)},
  }
}
      
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{
  <span style="color:#a6e22e">Name</span>:  <span style="color:#e6db74">&#34;jinzhu&#34;</span>,
  <span style="color:#a6e22e">Point</span>: <span style="color:#a6e22e">Point</span>{<span style="color:#a6e22e">X</span>: <span style="color:#ae81ff">100</span>, <span style="color:#a6e22e">Y</span>: <span style="color:#ae81ff">100</span>},
})
<span style="color:#75715e">// UPDATE `user_with_points` SET `name`=&#34;jinzhu&#34;,`point`=ST_PointFromText(&#34;POINT(100 100)&#34;) WHERE `id` = 1
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Hook</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 开始事务
</span><span style="color:#75715e"></span><span style="color:#a6e22e">BeforeSave</span>
<span style="color:#a6e22e">BeforeUpdate</span>
<span style="color:#75715e">// 关联前的 save
</span><span style="color:#75715e">// 更新 db
</span><span style="color:#75715e">// 关联后的 save
</span><span style="color:#75715e"></span><span style="color:#a6e22e">AfterUpdate</span>
<span style="color:#a6e22e">AfterSave</span>
<span style="color:#75715e">// 提交或回滚事务
</span></code></pre></div><ul>
<li>
<p>示例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">BeforeUpdate</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">readonly</span>() {
    <span style="color:#a6e22e">err</span> = <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;read only user&#34;</span>)
  }
  <span style="color:#66d9ef">return</span>
}
      
<span style="color:#75715e">// 在同一个事务中更新数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">AfterUpdate</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Confirmed</span> {
    <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Address</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;user_id = ?&#34;</span>, <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">ID</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;verfied&#34;</span>, <span style="color:#66d9ef">true</span>)
  }
  <span style="color:#66d9ef">return</span>
}
</code></pre></div></li>
</ul>
</li>
<li>
<p><code>UpdateColumn</code>，<code>UpdateColumns</code><strong>跳过Hook</strong>，并且不自动追踪更新时间</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 更新单个列
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">UpdateColumn</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;hello&#34;</span>)
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39; WHERE id = 111;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 更新多个列
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">UpdateColumns</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">18</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=18 WHERE id = 111;
</span><span style="color:#75715e"></span>  
<span style="color:#75715e">// 更新选中的列
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;age&#34;</span>).<span style="color:#a6e22e">UpdateColumns</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;hello&#34;</span>, <span style="color:#a6e22e">Age</span>: <span style="color:#ae81ff">0</span>})
<span style="color:#75715e">// UPDATE users SET name=&#39;hello&#39;, age=0 WHERE id = 111;
</span></code></pre></div></li>
<li>
<p><code>Changed</code>检查Model对象字段是否与<code>Update</code>，<code>Updates</code>的值是否一样，<strong>字段是否有变更</strong>，当字段未被忽略，且发生变更，则返回true，可以用在<code>Before Update Hook</code></p>
<ul>
<li>注意：<code>Changed</code>方法只能与<code>Update</code>，<code>Updates</code>一起使用</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">BeforeUpdate</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#75715e">// 如果 Role 字段有变更
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">Changed</span>(<span style="color:#e6db74">&#34;Role&#34;</span>) {
    <span style="color:#66d9ef">return</span> <span style="color:#a6e22e">errors</span>.<span style="color:#a6e22e">New</span>(<span style="color:#e6db74">&#34;role not allowed to change&#34;</span>)
    }
  
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">Changed</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;Admin&#34;</span>) { <span style="color:#75715e">// 如果 Name 或 Role 字段有变更
</span><span style="color:#75715e"></span>    <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">SetColumn</span>(<span style="color:#e6db74">&#34;Age&#34;</span>, <span style="color:#ae81ff">18</span>)
  }
  
  <span style="color:#75715e">// 如果任意字段有变更
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">Changed</span>() {
        <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">SetColumn</span>(<span style="color:#e6db74">&#34;RefreshedAt&#34;</span>, <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">Now</span>())
    }
    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; true
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; false, 因为 `Name` 没有变更
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;Admin&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">interface</span>{
  <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>, <span style="color:#e6db74">&#34;admin&#34;</span>: <span style="color:#66d9ef">false</span>,
})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; false, 因为 `Name` 没有被 Select 选中并更新
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; true
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; false, 因为 `Name` 没有变更
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">ID</span>: <span style="color:#ae81ff">1</span>, <span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu&#34;</span>}).<span style="color:#a6e22e">Select</span>(<span style="color:#e6db74">&#34;Admin&#34;</span>).<span style="color:#a6e22e">Updates</span>(<span style="color:#a6e22e">User</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#e6db74">&#34;jinzhu2&#34;</span>})
<span style="color:#75715e">// Changed(&#34;Name&#34;) =&gt; false, 因为 `Name` 没有被 Select 选中并更新
</span></code></pre></div></li>
<li>
<p><code>SetColumn</code>更新时在Hook中<strong>变更字段值</strong></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">user</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">BeforeSave</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">pw</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">bcrypt</span>.<span style="color:#a6e22e">GenerateFromPassword</span>(<span style="color:#a6e22e">user</span>.<span style="color:#a6e22e">Password</span>, <span style="color:#ae81ff">0</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">==</span> <span style="color:#66d9ef">nil</span> {
    <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">SetColumn</span>(<span style="color:#e6db74">&#34;EncryptedPassword&#34;</span>, <span style="color:#a6e22e">pw</span>)
  }
  
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">Changed</span>(<span style="color:#e6db74">&#34;Code&#34;</span>) {
    <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Age</span> <span style="color:#f92672">+=</span> <span style="color:#ae81ff">20</span>
    <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Statement</span>.<span style="color:#a6e22e">SetColumn</span>(<span style="color:#e6db74">&#34;Age&#34;</span>, <span style="color:#a6e22e">s</span>.<span style="color:#a6e22e">Age</span><span style="color:#f92672">+</span><span style="color:#ae81ff">20</span>)
  }
}
  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;Name&#34;</span>, <span style="color:#e6db74">&#34;jinzhu&#34;</span>)
</code></pre></div></li>
</ul>
<h5 id="删除">删除<a class="anchor ms-1" href="#删除"><i class="fas fa-link"></i></a></h5>
<ul>
<li>
<p><code>Delete</code>指定主键，删除一条记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}, <span style="color:#ae81ff">10</span>)
<span style="color:#75715e">// DELETE FROM users WHERE id = 10;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}, <span style="color:#e6db74">&#34;10&#34;</span>)
<span style="color:#75715e">// DELETE FROM users WHERE id = 10;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>, []<span style="color:#66d9ef">int</span>{<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">3</span>})
<span style="color:#75715e">// DELETE FROM users WHERE id IN (1,2,3);
</span></code></pre></div></li>
<li>
<p><code>Delete</code>不指定主键批量删除</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;email LIKE ?&#34;</span>, <span style="color:#e6db74">&#34;%jinzhu%&#34;</span>).<span style="color:#a6e22e">Delete</span>(<span style="color:#a6e22e">Email</span>{})
<span style="color:#75715e">// DELETE from emails where email LIKE &#34;%jinzhu%&#34;;
</span><span style="color:#75715e"></span>  
<span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#a6e22e">Email</span>{}, <span style="color:#e6db74">&#34;email LIKE ?&#34;</span>, <span style="color:#e6db74">&#34;%jinzhu%&#34;</span>)
<span style="color:#75715e">// DELETE from emails where email LIKE &#34;%jinzhu%&#34;;
</span></code></pre></div></li>
<li>
<p>Gorm默认<strong>不执行无条件的批量删除</strong>，需要添加额外的条件以强制批量删除</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{}).<span style="color:#a6e22e">Error</span> <span style="color:#75715e">// gorm.ErrMissingWhereClause
</span></code></pre></div><ul>
<li>
<p>使用原生SQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Exec</span>(<span style="color:#e6db74">&#34;DELETE FROM users&#34;</span>)
<span style="color:#75715e">// DELETE FROM users
</span></code></pre></div></li>
<li>
<p>添加额外的条件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;1 = 1&#34;</span>).<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// DELETE FROM `users` WHERE 1=1
</span></code></pre></div></li>
<li>
<p>启用<code>AllowGlobalUpdate</code>模式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Session</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">Session</span>{<span style="color:#a6e22e">AllowGlobalUpdate</span>: <span style="color:#66d9ef">true</span>}).<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// DELETE FROM users
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>添加<code>gorm.Deleteat</code>字段，启用GORM的软删除</p>
<ul>
<li>
<p>启用软删除时，当使用<code>Delete</code>时，记录不会从数据库中删除，GORM会将<code>DeleteAt</code>置为当前时间，并且无法通过正常的查询方法找到该条记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// user 的 ID 是 `111`
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// UPDATE users SET deleted_at=&#34;2013-10-29 10:23&#34; WHERE id = 111;
</span><span style="color:#75715e"></span>      
<span style="color:#75715e">// 批量删除
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;age = ?&#34;</span>, <span style="color:#ae81ff">20</span>).<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">User</span>{})
<span style="color:#75715e">// UPDATE users SET deleted_at=&#34;2013-10-29 10:23&#34; WHERE age = 20;
</span></code></pre></div></li>
<li>
<p>正常查询无法找到被软删除的记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 在查询时会忽略被软删除的记录
</span><span style="color:#75715e"></span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;age = 20&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">user</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE age = 20 AND deleted_at IS NULL;
</span></code></pre></div></li>
<li>
<p>查找被软删除的记录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Unscoped</span>().<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;age = 20&#34;</span>).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM users WHERE age = 20;
</span></code></pre></div></li>
<li>
<p>永久删除</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Unscoped</span>().<span style="color:#a6e22e">Delete</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">order</span>)
<span style="color:#75715e">// DELETE FROM orders WHERE id=10;
</span></code></pre></div></li>
</ul>
</li>
<li>
<p>Hook</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 开始事务
</span><span style="color:#75715e"></span><span style="color:#a6e22e">BeforeDelete</span>
<span style="color:#75715e">// 删除 db 中的数据
</span><span style="color:#75715e"></span><span style="color:#a6e22e">AfterDelete</span>
<span style="color:#75715e">// 提交或回滚事务
</span></code></pre></div><ul>
<li>
<p>示例</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#75715e">// 在同一个事务中更新数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">u</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">User</span>) <span style="color:#a6e22e">AfterDelete</span>(<span style="color:#a6e22e">tx</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">gorm</span>.<span style="color:#a6e22e">DB</span>) (<span style="color:#a6e22e">err</span> <span style="color:#66d9ef">error</span>) {
  <span style="color:#66d9ef">if</span> <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">Confirmed</span> {
    <span style="color:#a6e22e">tx</span>.<span style="color:#a6e22e">Model</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">Address</span>{}).<span style="color:#a6e22e">Where</span>(<span style="color:#e6db74">&#34;user_id = ?&#34;</span>, <span style="color:#a6e22e">u</span>.<span style="color:#a6e22e">ID</span>).<span style="color:#a6e22e">Update</span>(<span style="color:#e6db74">&#34;invalid&#34;</span>, <span style="color:#66d9ef">false</span>)
  }
  <span style="color:#66d9ef">return</span>
}
</code></pre></div></li>
</ul>
</li>
</ul>
<h3 id="locking">Locking<a class="anchor ms-1" href="#locking"><i class="fas fa-link"></i></a></h3>
<ul>
<li>
<p><code>FOR UPDATE</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Locking</span>{<span style="color:#a6e22e">Strength</span>: <span style="color:#e6db74">&#34;UPDATE&#34;</span>}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM `users` FOR UPDATE
</span></code></pre></div></li>
<li>
<p><code>FOR SHARE</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">Clauses</span>(<span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Locking</span>{
  <span style="color:#a6e22e">Strength</span>: <span style="color:#e6db74">&#34;SHARE&#34;</span>,
  <span style="color:#a6e22e">Table</span>: <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">Table</span>{<span style="color:#a6e22e">Name</span>: <span style="color:#a6e22e">clause</span>.<span style="color:#a6e22e">CurrentTable</span>},
}).<span style="color:#a6e22e">Find</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">users</span>)
<span style="color:#75715e">// SELECT * FROM `users` FOR SHARE OF `users`
</span></code></pre></div></li>
</ul>
<h3 id="关联">关联<a class="anchor ms-1" href="#关联"><i class="fas fa-link"></i></a></h3>
<ul>
<li>Belongs To</li>
<li></li>
</ul>
</div><div class="modal fade" id="rewardModal" tabindex="-1" aria-labelledby="rewardModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content surface">
      <div class="modal-header">
        <h5 class="modal-title" id="rewardModalLabel"><i class="fas fa-fw fa-coffee"></i>Buy me a coffee</h5>
        <a href="#" data-bs-dismiss="modal" class="btn btn-sm btn-outline-primary" aria-label="Close"><i class="fas fa-times"></i></a>
      </div>
      <div class="modal-body">
        <ul class="nav nav-tabs mb-3" role="tablist"><li class="nav-item text-nowrap" role="presentation">
            <a class="nav-link active" id="reward-alipay-tab" data-bs-toggle="tab" href="#reward-alipay" role="tab" aria-controls="reward-alipay" aria-selected="true">
              <i class="fab fa-fw fa-alipay"></i>Alipay
            </a>
          </li><li class="nav-item text-nowrap" role="presentation">
            <a class="nav-link" id="reward-wechat-tab" data-bs-toggle="tab" href="#reward-wechat" role="tab" aria-controls="reward-wechat" aria-selected="true">
              <i class="fab fa-fw fa-weixin"></i>WeChat
            </a>
          </li></ul>
        <div class="tab-content" id="rewardTabContent"><div class="tab-pane fade post-reward-content show active" id="reward-alipay" role="tabpanel" aria-labelledby="reward-alipay-tab">
            <img class="img-fluid post-reward-img" src="https://gitee.com/Euraxluo/images/raw/master/picgo/_alipay.jpg" loading="lazy" />
          </div><div class="tab-pane fade post-reward-content show" id="reward-wechat" role="tabpanel" aria-labelledby="reward-wechat-tab">
            <img class="img-fluid post-reward-img" src="https://gitee.com/Euraxluo/images/raw/master/picgo/_wechatpay.jpg" loading="lazy" />
          </div></div>
      </div>
    </div>
  </div>
</div><hr /><div class="post-copyright" id="post-copyright">
  <a class="d-flex align-items-center flex-column" target="_blank" rel="license noopener noreferrer" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">
    <span><i class="fab fa-fw fa-2x fa-creative-commons"></i><i class="fab fa-fw fa-2x fa-creative-commons-by"></i><i class="fab fa-fw fa-2x fa-creative-commons-nc"></i></span>
    CC BY-NC 4.0 
  </a>
</div>


<hr /><div class="post-navs d-flex mb-3 justify-content-evenly">
  <div class="post-nav post-prev"><i class="fas fa-fw fa-chevron-left"></i>
    <a href="/posts/note/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析
</a>
  </div><div class="post-nav post-next">
    <a href="/posts/note/etcd-%E5%85%A5%E9%97%A8/">etcd 基本使用
</a>
    <i class="fas fa-fw fa-chevron-right"></i>
  </div></div></div>
</article><div class="card component row post-comments" id="post-comments">
  <div class="card-header">
    <h2 class="card-title">Comments</h2>
  </div>
  <div class="card-body"><script src="https://utteranc.es/client.js"
  repo="Euraxluo/Euraxluo.github.io"
  issue-term="pathname"
  label="✨💬✨"
  theme="github-dark"
  crossorigin="anonymous"
  async>
</script></div>
</div></div>
</div><aside class="col-lg-4 sidebar d-flex">
  <div class="container">
    
    <section class="card row text-center profile component">
  <div class="card-body">
    <div class="col-12 d-flex align-items-center justify-content-center"><img class="profile-avatar rounded-circle" alt="Euraxluo" src="https://gitee.com/Euraxluo/images/raw/master/picgo/profile.png" loading="lazy"
  
   />
</div>
    <div class="col-12 profile-meta"><div class="profile-name">Euraxluo</div><div class="profile-bio">Engineer.</div><div class="profile-company"><i class="fas fa-fw fa-building"></i>dml</div><div class="profile-location"><i class="fas fa-fw fa-map-marker-alt"></i>Chengdu</div><div class="profile-about"><i class="fas fa-fw fa-user"></i><a href="/about/">About</a></div></div>
  </div>
</section>
  <section class="featured-posts row card component">
    <div class="card-header">
      <h2 class="card-title">Featured Posts</h2>
    </div>
    <div class="card-body">
      <ul class="post-list"><li>
          <a href="/posts/note/java%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AE%B0/">java面试笔记
</a>
        </li><li>
          <a href="/posts/python/python-socket/">python socket编程
</a>
        </li><li>
          <a href="/posts/note/rust%E5%AD%A6%E4%B9%A0/">rust学习
</a>
        </li><li>
          <a href="/posts/note/scala%E5%85%A5%E9%97%A8/">Scala入门
</a>
        </li><li>
          <a href="/posts/note/slam/">SLAM
</a>
        </li></ul>
    </div>
  </section><section class="recent-posts row card component">
  <div class="card-header">
    <h2 class="card-title">Recent Posts</h2>
  </div>
  <div class="card-body">
    <ul class="post-list"><li>
        <a href="/posts/note/etcd-%E5%85%A5%E9%97%A8/">etcd 基本使用
</a>
      </li><li>
        <a href="/posts/note/gorm/">GORM学习
</a>
      </li><li>
        <a href="/posts/note/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/">数据分析
</a>
      </li><li>
        <a href="/posts/distributed/%E5%88%86%E5%B8%83%E5%BC%8F%E6%8A%80%E6%9C%AF%E5%8E%9F%E7%90%86_%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%92%E6%96%A5/">分布式互斥
</a>
      </li><li>
        <a href="/posts/rpc/grpc%E5%AD%A6%E4%B9%A0/">gRPC学习
</a>
      </li></ul>
  </div>
</section><section class="taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/categories">Categories</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/categories/notes/" class="badge rounded post-taxonomy" title="notes">
            notes
          </a><a href="/categories/redis/" class="badge rounded post-taxonomy" title="redis">
            redis
          </a><a href="/categories/java/" class="badge rounded post-taxonomy" title="java">
            java
          </a><a href="/categories/%E7%88%AC%E8%99%AB/" class="badge rounded post-taxonomy" title="爬虫">
            爬虫
          </a><a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="badge rounded post-taxonomy" title="读书笔记">
            读书笔记
          </a><a href="/categories/architecture-design/" class="badge rounded post-taxonomy" title="architecture design">
            architecture design
          </a></div>
      </div>
    </section><section class="taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/series">Series</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/series/notes/" class="badge rounded post-taxonomy" title="notes">
            notes
          </a><a href="/series/redis/" class="badge rounded post-taxonomy" title="redis">
            redis
          </a><a href="/series/python/" class="badge rounded post-taxonomy" title="Python">
            Python
          </a><a href="/series/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" class="badge rounded post-taxonomy" title="读书笔记">
            读书笔记
          </a><a href="/series/java/" class="badge rounded post-taxonomy" title="Java">
            Java
          </a><a href="/series/jdbc/" class="badge rounded post-taxonomy" title="JDBC">
            JDBC
          </a></div>
      </div>
    </section><section class="taxonomies row card component">
      <div class="card-header">
        <h2 class="card-title">
          <a href="/tags">Tags</a>
        </h2>
      </div>
      <div class="card-body">
        <div class="py-2"><a href="/tags/notes/" class="badge rounded post-taxonomy" title="notes">
            notes
          </a><a href="/tags/redis/" class="badge rounded post-taxonomy" title="redis">
            redis
          </a><a href="/tags/python/" class="badge rounded post-taxonomy" title="Python">
            Python
          </a><a href="/tags/java/" class="badge rounded post-taxonomy" title="Java">
            Java
          </a><a href="/tags/%E7%88%AC%E8%99%AB/" class="badge rounded post-taxonomy" title="爬虫">
            爬虫
          </a><a href="/tags/architecture/" class="badge rounded post-taxonomy" title="architecture">
            architecture
          </a></div>
      </div>
    </section>
    
  </div>
</aside>
</div>
    </main><footer class="footer mt-auto py-3 text-center container-fluid"><nav class="social-links nav my-2 justify-content-center"><a class="nav-link social-link" href="mailto:Euraxluo@outlook.com" title="Email">
      <i class="fas fa-fw fa-2x fa-envelope"></i>
    </a><a class="nav-link social-link" target="_blank" href="https://github.com/Euraxluo" title="GitHub" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-github"></i>
      </a><a class="nav-link social-link" target="_blank" href="http://wpa.qq.com/msgrd?v=3&amp;uin=1793939176&amp;site=qq&amp;menu=yes" title="QQ" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-qq"></i>
      </a><a class="nav-link social-link" target="_blank" href="https://www.zhihu.com/people/euraxluo" title="Zhihu" rel="noopener noreferrer">
        <i class="fa-fw fa-2x fab fa-zhihu"></i>
      </a></nav>
<div class="copyright mb-2">
  Copyright © 2016-2022 Euraxluo. All Rights Reserved.
</div>
</footer>
<script src="/js/main.min.f5f268f204e7613e51f9150bce6d4f2d2189da621a72acfba40e044dec7a4555.js" integrity="sha256-9fJo8gTnYT5R&#43;RULzm1PLSGJ2mIacqz7pA4ETex6RVU=" crossorigin="anonymous" defer></script><script src="/js/icons.min.826b24319105653072608014fe71c31646df55ab93979d2b425a4058ec850236.js" integrity="sha256-gmskMZEFZTByYIAU/nHDFkbfVauTl50rQlpAWOyFAjY=" crossorigin="anonymous" defer></script>
<script src="/js/viewer.min.ab1b33cce3db4c6867de13f5a9e9805215e4129a8096c3dd867ffe5731592320.js" integrity="sha256-qxszzOPbTGhn3hP1qemAUhXkEpqAlsPdhn/&#43;VzFZIyA=" crossorigin="anonymous" defer></script><script defer src="/js/katex.min.d3d447c86fbb3d49dd3cb98498e5a26ed6b0e182456a454b4de0aa3166089989.js" integrity="sha256-09RHyG&#43;7PUndPLmEmOWibtaw4YJFakVLTeCqMWYImYk=" crossorigin="anonymous"></script>

</body>
</html>
