---
layout:     post                    # 使用的布局（不需要改）
title:      ROS學習               # 标题 
subtitle:   ROS基础学习                #副标题
date:       2019-01-18            # 时间
author:     Euraxluo                      # 作者
header-img: img/post-bg-github-cup.jpg  #这篇文章标题背景图片
catalog: true                 # 是否归档
tags:                               #标签
    - ROS

---

# ROS

### 工作空间:组织和管理功能包的文件夹
catkin workspace
>build (cmake,catkin缓存中间件)

>src(package 源代码)
>>package1(是catkin编译的基本单元)
>>package2
>>folder
>>>package3
>>>package3

>devel(目标文件)
>>头文件
>>动态连接库
>>静态连接库
>>可执行文件


### catkin(编译工具)
catkin ROS定制的编译构建系统

是对CMake的扩展

常用命令:
#### catkin_make:
>初始化,建立工作空间

eg:
```shell
mkdir -p ~/catkin_ws/src
cd ~/catkin_ws/
catkin_make
```
>编译

eg:
```shell
cd ~/catkin_ws #回到工作空间
catkin_make
source ~/catkin/devel/setup.bash #编译完成后需要使用source进行刷新
```
### package 功能包
是ROS软件的基本组织形式(一个个package)
catkin编译的基本单元
一个package可以包含多个节点(可执行文件),但是至少必须含有`CMakeLists.txt和package.XML`才能认为这是一个pkg

#### CMakeLists.txt
规定了catkin编译的规则(源文件,依賴項，目標文件)
eg:
```shell
cmake_mininum_required() #指定catkin的最低版本
project() #指定軟件包的name
find_package() #指定編譯時需要的依賴項
add_message_files()/add_service_files()/add_action_files()#添加消息文件/服務文件/動作文件
generate_message() #指定catkin信息給編譯系統生成cmake文件
add_library()/add_executable() #指定生成庫文件，可執行文件
target_link_libraries() #指定可執行文件鏈接那些庫
catkin_add_gtest() #添加單元測試
install() #生成可安裝目標
```
如果編譯過程中出現問題，一般都是這個文件的原因

#### package.XML 
包的自我描述：定义了package的属性,包名,版本号,作者,依賴等
```
<package><!--root-->
	<name><!--包名-->
	<version><!--版本号-->
	<description><!--包描述-->
	<maintainer><!--维护者-->
	<licsense><!--软件许可-->
	<buildtool_depend><!--编译工具-->
	<build_depend><!--编译时的依賴-->
	<run_depend><!--运行时的依賴-->
</package>
```
你也可能会看到manifest.xml,这是rosbuild编译系统使用的信息清單,类似catkin的package.XML

#### 代码文件: 源文件src(*.cpp/python module),頭文件include(*.h),腳本scripts(*.sh/*.py)

#### 自定義通信格式：消息msg(*.msg),服務srv(*.srv),動作action(*.action)

#### lauch文件(*.lauch):使多个可执行文件一起运行

#### 配置文件:config(*.yaml)

### 这样一来,我们的package目录结构就变成了:
package
>CMakeList.txt
>package.XML
>script
>
>>*.py/*.sh

>include
>
>>*.h

>src
>
>>*.cpp/python modulel

>msg
>
>>*.msg

>srv
>
>>*.srv

>action
>
>>*.action

>lauch
>
>>*.lauch

>config
>
>>*.yaml

### ros文件系统
常用操作:
#### rospack
查找某个pkg的地址
`rospack find pkg_name`

列出本地全部的pkg
`rospack list`

#### roscd
跳转到pkg的路径下
`roscd pkg_name`

#### rosls
列举某个pkg下的文件信息
`rosls pkg_name`

#### rosed
编辑pkg下的文件
`rosed pkg_name file_name`

#### catkin_create_pkg
创建一个pkg
`catkin_create_pkg <pkg_name> [deps]`
deps指的是这个pkg需要安装哪些依賴

#### rosdep
安裝某個pkg所需要的依賴
`rosdep install [pkg_name]`
主要给下载的pkg安装所需要的依賴

#### 例子：
```shell
#下載tree
sudo apt insall tree
#建立一個帶src的文件目錄
mkdir -p catkin_ws/src
#cd 到workspace
cd catkin_ws/
#tree查看文件結構
tree
#初始化
catkin_make
#显示1級目录
tree -L 1
#cd到src
cd src
#新建一个pkg
catkin_create_pkg test1
#查看文件结构
tree
#在建立pkg时制定依賴(cpp依賴,py依賴,通信依賴,导航依賴)
catkin_create_pkg test2 roscpp rospy std_msgs nav_msgs
```
最后,我们的文件目录是:
catkin_ws
>build
>devel
>src
>>CMakeList.txt
>>test1
>>>CMakeList.txt
>>>package.XML

>>test2
>>>CMakeList.txt
>>>include
>>>
>>>>test2

>>>package.xml
>>>src

#### 对于外部克隆下载的文件:
```shell
#cd 到工作空间
cd ~/catkin_ws/src
#下载或者克隆
git clone ```
cd ~/catkin_ws
#安装依賴
rosdep install [pkg_name]
#编译
catkin_make
#刷新环境(一般选择在配置文件中加入这句话)
source ~/catkin_ws/devel/setup.bash
```
最后一句如果:`echo "source ~/catkin_ws/devel/setup.bash" >> ~/.bashrc`
这样,我们每次打开一个新的终端,就会刷新一下source

### metapackage
ros官网称作stack(软件包集),其实指的是自己没有很多内容,大量依賴了其他的包的(link包?)

主要的一些metapackage:
navigation:导航相关
moveit:控制机械臂
image_pipeline:图像获取,处理
vision_opencv:ROS与openCV交互的功能包集
turtlebot:turtlebot机器人相关的包
pr2_robot:pr2机器人驱动功能包集

### ROS通信架构

#### master
节点管理器,管理node之间的通信
每个节点node启动时都需要向master注册
node1--注册-->master---->node2

我们在启动ROS时:
1. 先启动master:
`roscore`
可以启动master(节点管理器),rosout(日志输出),parameter server(参数服务器)

2. 启动node的一些相关命令:

启动node
`rosrun [pkg_name] [node_name]`

列出当前运行的node的详细信息
`rosnode info [node_name]`

结束运行node:
`rosrun kill [node_name]`

多个node需要启动时:
使用roslaunch,可以同时启动master和多个node
`roslaunch [pkg_name] [file_name.launch]`

其中file_name.launch的写法如下:
```xml
<launch>
	<node><!--需要启动的node及其参数-->
	<include><!--包含其他launch文件-->
	<machine><!--指定运行的機器-->
	<env_loader><!--设置环境变量-->
	<param><!--定义参数到参数服务器-->
	<arg><!--定义参数传到launch文件中-->
	<remap><!--设置参数映射-->
	<group><!--设置命名空间-->
</launch>
```
eg:`roslaunch pr2_bingup pr2.launch`

## 通信方式