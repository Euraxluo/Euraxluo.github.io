---
layout:     post                    # 使用的布局（不需要改）
title:      ROS学习               # 标题 
subtitle:   Apollo架构学习                #副标题
date:       2019/3/14            # 时间
author:     Euraxluo                      # 作者
header-img: img/post-bg-github-cup.jpg  #这篇文章标题背景图片
catalog: true                 # 是否归档
tags:                               #标签
    - ROS

---
## Apollo无人车架构
以HD-map为核心
###  线控车辆，计算机和传感器通过CAN卡进行通信
### ROTS(Ubuntu+apollo kernel)
保证实时性
### Feameworf(ROS+)
1. 共享内存
- 减少传输中的数据拷贝，提高传输效率，减少传输延迟
- 有效解决一对多传输
- 共享内存减少CPU资源占用，提高机器计算能力

2. 数据兼容
- 引入了protopuf文件格式
- 可以向后兼容
- ROS深度兼容protopuf格式

3. 去中心化，减小单点故障的影响
- 使用RTPS服务发现协议
- 以域作为划分，通过rtps相互广播，实现完全P2P
- sub节点启动，组播registerNode->节点发现及建立unicast->向新加节点发送历史消息->收发双方建立连接，开始通信

### application
- planning
- control
- end-to-end driving
- human-machine
- map-engine
- localization
- preception

## REDME：
### 定位
- GPS+IMU -> Real Time Kine
- GPS+IMU+激光雷达（光探测，测距传感器）->多传感器融合
### 预测
从感知模块接受障碍物信息（位置，方向速度，加速度）
生成不同概率的预测轨迹
- 容器
存储订阅通道的输入数据（障碍物，车辆定位，车辆规划）
- 评估器
对任何给定的障碍物分别预测路径和速度，通过模型给出的路径概率来进行评估
   1).成本评估器:概率是由成本函数给出
   2).MLP评估器:用MLP模型计算概率
   3).RNN评估器:用RNN模型计算
- 预测器
生成障碍物的预测轨迹，预测规则有很多：
   1). 单行道：在公路导航模式下障碍物沿着单条车道移动。不在车道上的障碍物将被忽略。
   2). 车道顺序：障碍物沿车道移动
   3). 移动序列：障碍物沿其运动模式沿车道移动
   4). 自由运动：障碍物自由移动
   5). 区域运动：障碍物在可能的区域中移动

### 路由
根据路由请求(开始和结束位置)以及地图数据生成高级导航信息
- 依赖路由拓扑文件

### 规划
通过配置和参数规划不同的场景
apollo是车道保持，通过障碍物，通过十字路有
- planning
   1). FSM，有限状态机
   2). Planning Dispatcher,根据车辆状态和其他信息，调用合适的planner
   3). planner获取context，确定车辆意图，执行该意图所需的规划任务，并生成规划轨迹，并更新未来作业的contxt
   4)Deciders&Optimizers：实现决策和优化的无状态库。优化器优化车辆的轨迹和速度。决策者对当前场景进行分类

### 控制
基于规划和当前的汽车状态，使用不同的控制算法，控制模块可以在正常模式和导航模式下工作
- 输入：规划轨迹，车辆状态，定位和自动模式更改请求
- 输出：给底盘的控制指令

## HD Map
1. 给出道路网的精确三维表征
2. 提供语义信息，帮助决策规划器减小选择范围
3. HD-map构建过程
- data source（百度有300辆地图车）
- data peocessing，整理，分类，清洗 ->without semantic & annotation
- obj detection
- 手动验证（apollo使用软件进行地图编辑）
- map publication（使用众包，加快构建过程，大家都可以参与）

