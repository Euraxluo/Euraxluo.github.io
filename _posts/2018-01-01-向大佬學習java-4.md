---
layout:   post          
title:   sql学习 
date:    2018-01-01    
author:   Euraxluo           
categories: java
tags:  查询 列名 表名
---
* TOC
{:toc}


# 小cookie
## 1<>1 的用处： 用于只取结构不取数据的场合 
例如：
```

create table table_temp tablespace tbs_temp as 

select * from table_ori where 1<>1 

```

建成一个与table_ori 结构相同的表table_temp，但是不要table_ori 里的数据。（除了表结构，其它结构也同理)



##1=1的用处： 用于动态SQL



在组合查询条件时候多用：



```

String sql="select * from user where 1=1 "; 



if(username!=null) sql=sql+ " and username='"+username+"'"; 



if(password!=null) sql=sql+ " and password='"+password+"'"; 

```

这样方便很多，及时username，password两者都为空都可以查询



永远为真 相当于没有限制名称条件。但是如果没有1=1的条件，

# PacketTooBigException

## 问题描述

保存数据到MySQL时遇到以下错误：



Error updating database.  Cause: com.mysql.jdbc.PacketTooBigException: Packet for query is too large (10113 > 1024). You can change this value on the server by setting the max_allowed_packet'。



原因是MySQL的max_allowed_packet设置过小引起的，默认设置的是1M，操作数据大于1M会受max_allowed_packet参数限制；改为了10M后问题解决。



使用SQL： show VARIABLES like '%max_allowed_packet%'; 查看max_allowed_packet大小。



## 解决方案



1\. 在my.cnf中（windows下my.ini）修改 max_allowed_packet大小为10M；max_allowed_packet = 10M。

2\. 保存并退出。

3\. 重启MySQL服务即可

# sql关键字

![image.png](https://upload-images.jianshu.io/upload_images/10020820-f95aa76f4d7dedd7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image.png](https://upload-images.jianshu.io/upload_images/10020820-2ecd124d5c886985.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

![image.png](https://upload-images.jianshu.io/upload_images/10020820-e97d0ab0b8fac218.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)

ySQL允许部分关键字用做未引起来的识别符，因为许多人以前曾使用过它们。下面列出了一些例子：

•	ACTION

•	BIT

•	DATE

•	ENUM

•	NO

•	TEXT

•	TIME

•	TIMESTAMP

•	CHARACTER

# 使用内部函数instr，可代替传统的like方式查询，并且速度更快。

instr函数，第一个参数是字段，第二个参数是要查询的串，返回串的位置，第一个是1，如果没找到就是0.

  

例如，

  

SELECT * FROM bank_order WHERE instr(`y_name`,'测试');

  

可查询名字中带 “测试” 的内容。



## 错误指正

`select * from phone where instr(phoneName,'Meizu') and instr(theme,'下');`



# **[SQL替换语句  批量修改、增加、删除字段内容](http://www.cnblogs.com/fishtreeyu/archive/2011/10/19/2217125.html)**

  

  sql替换语句，用该命令可以整批替换某字段的内容，也可以批量在原字段内容上加上或去掉字符。

  

  命令总解：update 表的名称 set 此表要替换的字段名=REPLACE(此表要替换的字段名, '原来内容', '新内容')

  

  如 UPDATE Whir_ProductRelese SET ReleseName=REPLACE(ReleseName,'[http://www.maidq.com](http://www.maidq.com/)','[http://maidq.com](http://www.maidq.com/)')

  

  举例说明：

  

  1）把backupfile表里url的字段内容里为[http://www.maidq.com](http://www.maidq.com/)的字符全部改为[http://maidq.com](http://maidq.com/)。

  

  　　update backupfile set url=REPLACE(url,'[http://www.maidq.com](http://www.maidq.com/)','[http://maidq.com](http://www.maidq.com/)')

  

  2）根据条件增加字段的内容，如把file_number=1的记录的logical_name字段的内容前面加上tmp，后面加上end。

  

  　　update backupfile set logical_name=REPLACE(logical_name,logical_name,'tmp'+logical_name+' end ') where file_number=1

  

  3）根据条件去掉指定记录的前面2个字符。

  

  　　update backupfile set logical_name=REPLACE(logical_name,logical_name,SUBSTRING(logical_name,3,len(logical_name)-2)) where file_number=1

  

  4）根据条件去掉指定记录的后面4个字符。

  

  　　update backupfile set logical_name=REPLACE(logical_name,logical_name,SUBSTRING(logical_name,1,len(logical_name)-4)) where file_number=2

  

  如有不清楚的可以先用select语句验证是否达成自己想要的效果再进行替换：

  

  SELECT   REPLACE(替换字段,'原内容','新内容') from 表名;  

  

  update 表名 set 替换字段=(REPLACE(替换字段,'原内容','新内容'))

 

# SQL語句order-by兩個字段排序

  ORDER BY  后可加2个字段，用英文逗号隔开。

  

  f1用升序， f2降序，SQL该这样写

  

  ORDERBY  f1, f2  DESC

  

  也可以这样写，更清楚：

  

  ORDERBY  f1 ASC, f2  DESC

  

  如果都用降序，必须用两个desc

  

  ORDERBY  f1 DESC, f2 DESC

  

# 增刪改查



## 一、增：有4种方法 

###　　1.使用insert插入单行数据： 

　　 语法：insert [into] <表名> [列名] values <列值> 

　　 例：insert into Strdents (姓名,性别,出生日期) values (‘开心朋朋’,’男’,’1980/6/15’) 

　　 注意：into可以省略；列名列值用逗号分开；列值用单引号因上；如果省略表名，将依次插入所有列

###　　2.使用insert select语句将现有表中的数据添加到已有的新表中 

　　 语法：insert into <已有的新表> <列名> 

　　 　　　select <原表列名> from <原表名> 

　　 例：insert into tongxunlu (‘姓名’,’地址’,’电子邮件’) 

　　 　　select name,address,email 

　　 　　from Strdents 

　　 注意：into不可省略；查询得到的数据个数、顺序、数据类型等，必须与插入的项保持一致

###　　3.使用select into语句将现有表中的数据添加到新建表中 

　　 语法：select <新建表列名> into <新建表名> from <源表名> 

　　 例：select name,address,email into tongxunlu from strdents 

　　 注意：新表是在执行查询语句的时候创建的，不能够预先存在 

　　 在新表中插入标识列（关键字‘identity’）： 

　　 语法：select identity (数据类型，标识种子，标识增长量) AS 列名 

　　 　　　into 新表 from 原表名 

　　 例：select identity(int,1,1) as 标识列,dengluid,password into tongxunlu from Struents 

　　 注意：关键字‘identity’

###　　4.使用union关键字合并数据进行插入多行 

　　 语法：insert <表名> <列名> select <列值> tnion select <列值> 

　　 例：insert Students (姓名,性别,出生日期) 

　　 　　select ‘开心朋朋’,’男’,’1980/6/15’ union（union表示下一行） 

　　 　　select ‘蓝色小明’,’男’,’19**//’ 

　　 注意：插入的列值必须和插入的列名个数、顺序、数据类型一致

## 二、删：有２中方法 

　　1.使用delete删除数据某些数据 

　　 语法：delete from <表名> [where <删除条件>] 

　　 例：delete from a where name=’开心朋朋’（删除表a中列值为开心朋朋的行） 

　　 注意：删除整行不是删除单个字段，所以在delete后面不能出现字段名 

　　2.使用truncate table 删除整个表的数据 

　　 语法：truncate table <表名> 

　　 例：truncate table tongxunlu 

　　 注意：删除表的所有行，但表的结构、列、约束、索引等不会被删除；不能用语有外建约束引用的表

## 三、改 

　　使用update更新修改数据 

　　 语法：update <表名> set <列名=更新值> [where <更新条件>] 

　　 例：update tongxunlu set 年龄=18 where 姓名=’蓝色小名’ 

　　 注意：set后面可以紧随多个数据列的更新值；where子句是可选的，用来限制条件，如果不选则整个表的所有行都被更新

## 四、查 

### 1.普通查询 

　　 语法：select <列名> from <表名> [where <查询条件表达试>][order by <排序的列名>[asc或desc]] 

####　　　1).查询所有数据行和列 

　　　　例：select * from a 

　　　　说明：查询a表中所有行和列 

####　　　2).查询部分行列–条件查询 

　　　　例：select i,j,k from a where f=5 

　　　　说明：查询表a中f=5的所有行，并显示i,j,k３列 

####　　　3).在查询中使用ＡＳ更改列名 

　　　　例：select name as 姓名　from a whrer xingbie=’男’ 

　　　　说明：查询a表中性别为男的所有行，显示name列，并将name列改名为（姓名）显示 

####　　　4).查询空行 

　　　　例：select name from a where email is null 

　　　　说明：查询表a中email为空的所有行，并显示name列；SQL语句中用is null或者is not null来判断是否为空行 

####　　　5).在查询中使用常量 

　　　　例：select name ‘唐山’ as 地址 from　a 

　　　　说明：查询表a，显示name列，并添加地址列，其列值都为’唐山’ 

####　　　6).查询返回限制行数(关键字：top percent) 

　　　　例１：select top 6 name from a 

　　　　说明：查询表a，显示列name的前６行，top为关键字 

　　　　例２：select top 60 percent name from a 

　　　　说明：查询表a，显示列name的60%，percent为关键字 

####　　　7).查询排序（关键字：order by , asc , desc） 

　　　　例：select name 

　　　　　　from a 

　　　　　　where chengji>=60 

　　　　　　order by desc 

　　　　说明：查询表中chengji大于等于60的所有行，并按降序显示name列；默认为ＡＳＣ升序

### ２.模糊查询 

####　　　1).使用like进行模糊查询 

　　　　注意：like运算副只用语字符串，所以仅与char和varchar数据类型联合使用 

　　　　例：select * from a where name like ‘赵%’ 

　　　　说明：查询显示表a中，name字段第一个字为赵的记录

####　　　2).使用between在某个范围内进行查询 

　　　　例：select * from a where nianling between 18 and 20 

　　　　说明：查询显示表a中nianling在18到20之间的记录 

####　　　3).使用in在列举值内进行查询 

　　　　例：select name from a where address in (‘北京’,’上海’,’唐山’) 

　　　　说明：查询表a中address值为北京或者上海或者唐山的记录，显示name字段

### ３.分组查询 

####　　　1).使用group by进行分组查询 

　　　　例：select studentID as 学员编号, AVG(score) as 平均成绩 (注释:这里的score是列名) 

　　　　　　from score (注释:这里的score是表名) 

　　　　　　group by studentID 

　　　　说明：在表score中查询，按strdentID字段分组，显示strdentID字段和score字段的平均值；select语句中只允许被分组的列和为每个分组返回的一个值的表达试，例如用一个列名作为参数的聚合函数 

####　　　2).使用having子句进行分组筛选 

　　　　例：select studentID as 学员编号, AVG(score) as 平均成绩 (注释:这里的score是列名) 

　　　　　　from score (注释:这里的score是表名) 

　　　　　　group by studentID 

　　　　　　having count(score)>1 

　　　　说明：接上面例子，显示分组后count(score)>1的行，由于where只能在没有分组时使用，分组后只能使用having来限制条件，

### ４.多表联接查询 

#### 1).内联接 

#####　　　　①在where子句中指定联接条件 

　　　　例：select a.name,b.chengji 

　　　　　　from a,b 

　　　　　　where a.name=b.name 

　　　　说明：查询表a和表b中name字段相等的记录，并显示表a中的name字段和表b中的chengji字段 

#####　　　　②在from子句中使用join…on 

　　　　　例：select a.name,b.chengji 

　　　　　　　from a inner join b 

　　　　　　　on (a.name=b.name) 

　　　　　说明：同上 

####　　2).外联接 

#####　　　　①左外联接查询 

　　　　　例：select s.name,c.courseID,c.score 

　　　　　　　from strdents as s 

　　　　　　　left outer join score as c 

　　　　　　　on s.scode=c.strdentID 

　　　　　说明：在strdents表和score表中查询满足on条件的行，条件为score表的strdentID与strdents表中的sconde相同 

#####　　　　②右外联接查询　 

　　　　　例：select s.name,c.courseID,c.score 

　　　　　　　from strdents as s 

　　　　　　　right outer join score as c 

　　　　　　　on s.scode=c.strdentID 

　　　　　说明：在strdents表和score表中查询满足on条件的行，条件为strdents表中的sconde与score表的strdentID相同



