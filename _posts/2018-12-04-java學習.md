---
layout:     post                    # 使用的布局（不需要改）
title:      java學習               # 标题 
subtitle:   服務演進                #副标题
date:       2018-12-04             # 时间
author:     Euraxluo                      # 作者
header-img: img/post-bg-github-cup.jpg  #这篇文章标题背景图片
catalog: true                 # 是否归档
tags:                               #标签
    - java

---

# 服务演进
1. 数据服务器和应用服务器在一台机器
2. 数据服务器配置大硬盘服务器，应用服务器性能更好
3. 使用缓存服务器『具有那种特点的数据使用缓存，具有哪种特点的数据使用本地缓存，具有哪种特点的数据使用分布式缓存（分布式缓存的算法，分布式缓存的扩容）』
4. 加入负载均衡调度服务器（解决横向扩展服务器）
>负载均衡的调度策略，以及有缺点
>>权重
>>
>>>考虑了每台服务器处理能力的不同

>>轮询
>>>优点:实现简单
>>>缺点:不考虑每台服务器的处理能力

>>地址散列
>>>能实现同一个用户访问同一台服务器
>>>源ip地址散列
>>>目标ip地址散列


>>最小连接
>>
>>>让集群中的服务器负载更加均衡

>>加权最小连接
>>
>>>算法:$\frac{(活动连接数+非活动连接数)}{权重}$越小最先被选择

5. 新的问题:session的访问问题
    1 )假设我们的负载均衡调度策略是根据ip哈西散列(不够分散,不够均匀),会使每台服务器的负载不同,对网卡带宽造成压力
    2) 假设使用轮询的策略,我们的session第一次保存在A服务器,第二次可能可能用户访问的B服务器

  >1. 使用调度把这个用户的访问交给保存有session的服务器
  >>缺点:1.如果保存有session的服务器挂了2.负载均衡调度服务器有状态,容灾能力降低

  >2. session复制
  > >>当一台服务器有新的session,会同步到其他服务器
  > >>
  > >>>缺点:1. 带宽问题,两台服务器需要不停的同步session信息2. 当有大量用户同时在线时,内存会很大,只适合用户比较小的情况

  >3. Cookie with Session
  > >>用户使用携带session的cookie去访问服务器
  > >>
  > >>>缺点:cookie的长度限制2. cookie保存在服务器上,有安全问题

  >4. session服务器
  > >>用户访问服务器过后,把session信息转存在session服务器
  > >>>使用时,从session服务器中获取用户的session
  > >>>缺点:session服务器是单点的,应该改成集群,这种情况适合于服务器多
  > >>>
  > >>>>类似:单点登陆(为什么,解决方案以及忧缺点)

6. 服务器的瓶颈
>通过服务器的读写分离,然后主从互相copy
>
>>主写从读

>使用统一的数据访问模型进行读写
>应该对读写分离模型进行封装
>数据路由

7. 在调度均衡服务器的上游加入CDN,反向代理服务器
>CDN解决不同地区的用户的访问速度
>反向代理,可以缓存用户的资源

8. 文件服务器的瓶颈:使用集群
>在演进时如何不影响部署在线上的业务的访问
>>重新域名解析?
>>备份?
>>数据清洗?

9. 可以把数据库改为每个业务一个数据库(把表变成库)
>>跨库的事务
>>数据库的水平拆分
>>
>>>sql路由(如何知道用户的数据存储的位置)

10. 应用服务器的演进
>把搜索功能做成搜索引擎
>把部分场景做成NOSQL SERVER提高性能

11. 其他问题:
>负载均衡调度服务器为单点,如果访问不了?

12. 扩展:
>安全性,数据分析,监控,反作弊
>SOA架构,服务化,消息队列,任务调度,多机房